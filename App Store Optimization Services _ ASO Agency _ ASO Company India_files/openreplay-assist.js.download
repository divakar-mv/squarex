!function(){"use strict";"undefined"!=typeof window&&(window.parcelRequire=window.parcelRequire||void 0);const i=Object.create(null),j=(i.open="0",i.close="1",i.ping="2",i.pong="3",i.message="4",i.upgrade="5",i.noop="6",Object.create(null)),M=(Object.keys(i).forEach(e=>{j[i[e]]=e}),{type:"error",data:"parser error"}),B="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),U="function"==typeof ArrayBuffer,F=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,z=({type:e,data:t},n,r)=>B&&t instanceof Blob?n?r(t):V(t,r):U&&(t instanceof ArrayBuffer||F(t))?n?r(t):V(new Blob([t]),r):r(i[e]+(t||"")),V=(e,t)=>{const n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)};var H="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";const q="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<H.length;e++)q[H.charCodeAt(e)]=e;const W=e=>{let t=.75*e.length,n=e.length,r,i=0,s,o,a,c;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);const l=new ArrayBuffer(t),d=new Uint8Array(l);for(r=0;r<n;r+=4)s=q[e.charCodeAt(r)],o=q[e.charCodeAt(r+1)],a=q[e.charCodeAt(r+2)],c=q[e.charCodeAt(r+3)],d[i++]=s<<2|o>>4,d[i++]=(15&o)<<4|a>>2,d[i++]=(3&a)<<6|63&c;return l},G="function"==typeof ArrayBuffer,J=(e,t)=>{if("string"!=typeof e)return{type:"message",data:K(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:((e,t)=>{if(G){const n=W(e);return K(n,t)}else return{base64:true,data:e}})(e.substring(1),t)}:j[n]?1<e.length?{type:j[n],data:e.substring(1)}:{type:j[n]}:M},K=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e,Y=String.fromCharCode(30);function r(e){if(e){var t,n=e;for(t in r.prototype)n[t]=r.prototype[t];return n}}r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},r.prototype.emitReserved=r.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length};const n="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function $(n,...e){return e.reduce((e,t)=>(n.hasOwnProperty(t)&&(e[t]=n[t]),e),{})}const X=setTimeout,Q=clearTimeout;function Z(e,t){t.useNativeTimers?(e.setTimeoutFn=X.bind(n),e.clearTimeoutFn=Q.bind(n)):(e.setTimeoutFn=setTimeout.bind(n),e.clearTimeoutFn=clearTimeout.bind(n))}class ee extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class te extends r{constructor(e){super(),this.writable=!1,Z(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new ee(e,t,n)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){e=J(e,this.socket.binaryType);this.onPacket(e)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const ne="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),re=64,ie={};let se=0,oe=0,ae;function ce(e){let t="";for(;t=ne[e%re]+t,0<(e=Math.floor(e/re)););return t}function le(){var e=ce(+new Date);return e!==ae?(se=0,ae=e):e+"."+ce(se++)}for(;oe<re;oe++)ie[ne[oe]]=oe;function de(e){let t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}let pe=!1;try{pe="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const he=pe;function ue(e){e=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||he))return new XMLHttpRequest}catch(e){}if(!e)try{return new n[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}function fe(){}const me=null!=new ue({xdomain:!1}).responseType;class s extends r{constructor(e,t){super(),Z(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=$(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref"),t=(e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs,this.xhr=new ue(e));try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var n in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.opts.extraHeaders[n])}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof t.status?t.status:0)},0))},t.send(this.data)}catch(e){return void this.setTimeoutFn(()=>{this.onError(e)},0)}"undefined"!=typeof document&&(this.index=s.requestsCount++,s.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=fe,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete s.requests[this.index],this.xhr=null}}onLoad(){var e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function ge(){for(var e in s.requests)s.requests.hasOwnProperty(e)&&s.requests[e].abort()}s.requestsCount=0,s.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",ge):"function"==typeof addEventListener&&(e="onpagehide"in n?"pagehide":"unload",addEventListener(e,ge,!1)));const ve="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),ye=n.WebSocket||n.MozWebSocket,be="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const Ce={websocket:class extends te{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(this.check()){var e=this.uri(),t=this.opts.protocols;const n=be?{}:$(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=be?new ye(e,t,n):t?new ye(e,t):new ye(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){var n=t[e];const r=e===t.length-1;z(n,this.supportsBinary,e=>{try{this.ws.send(e)}catch(e){}r&&ve(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};var t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&("wss"==t&&443!==Number(this.opts.port)||"ws"==t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=le()),this.supportsBinary||(e.b64=1);var r=de(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}check(){return!!ye}},polling:class extends te{constructor(t){if(super(t),this.polling=!1,"undefined"!=typeof location){var n="https:"===location.protocol;let e=location.port;e=e||(n?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||e!==t.port,this.xs=t.secure!==n}n=t&&t.forceBase64;this.supportsBinary=me&&!n}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{var n=e.split(Y);const r=[];for(let e=0;e<n.length;e++){var i=J(n[e],t);if(r.push(i),"error"===i.type)break}return r})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){var e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1;{var r=e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})};const i=e.length,s=new Array(i);let n=0;return void e.forEach((e,t)=>{z(e,!1,e=>{s[t]=e,++n===i&&r(s.join(Y))})})}}uri(){let e=this.query||{};var t=this.opts.secure?"https":"http";let n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=le()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"==t&&443!==Number(this.opts.port)||"http"==t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);var r=de(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new s(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}},we=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Se=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function _e(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=we.exec(e||""),s={},o=14;for(;o--;)s[Se[o]]=i[o]||"";return-1!=n&&-1!=r&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e){const t=e.replace(/\/{2,9}/g,"/").split("/");"/"!=e.substr(0,1)&&0!==e.length||t.splice(0,1);"/"==e.substr(e.length-1,1)&&t.splice(t.length-1,1);return t}((s,s.path)),s.queryKey=function(e){const r={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(r[t]=n)}),r}((s,s.query)),s}class ke extends r{constructor(e,t={}){super(),e&&"object"==typeof e&&(t=e,e=null),e?(e=_e(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=_e(t.host).host),Z(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function(e){let n={},r=e.split("&");for(let e=0,t=r.length;e<t;e++){var i=r[e].split("=");n[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return n}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Ce[e](n)}open(){let e;if(this.opts.rememberUpgrade&&ke.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),(this.transport=e).on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",e=>this.onClose("transport close",e))}probe(e){let n=this.createTransport(e),r=!1;ke.priorWebsocketSuccess=!1;const t=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",e=>{if(!r)if("pong"===e.type&&"probe"===e.data)this.upgrading=!0,this.emitReserved("upgrading",n),n&&(ke.priorWebsocketSuccess="websocket"===n.name,this.transport.pause(()=>{r||"closed"!==this.readyState&&(l(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())}));else{const t=new Error("probe error");t.transport=n.name,this.emitReserved("upgradeError",t)}}))};function i(){r||(r=!0,l(),n.close(),n=null)}const s=e=>{const t=new Error("probe error: "+e);t.transport=n.name,i(),this.emitReserved("upgradeError",t)};function o(){s("transport closed")}function a(){s("socket closed")}function c(e){n&&e.name!==n.name&&i()}const l=()=>{n.removeListener("open",t),n.removeListener("error",s),n.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};n.once("open",t),n.once("error",s),n.once("close",o),this.once("close",a),this.once("upgrading",c),n.open()}onOpen(){if(this.readyState="open",ke.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let e=0;for(var t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){var e;"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(e=this.getWritablePackets(),this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush"))}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&1<this.writeBuffer.length))return this.writeBuffer;let t=1;for(let e=0;e<this.writeBuffer.length;e++){var n=this.writeBuffer[e].data;if(n&&(t+=function(e){if("string"!=typeof e)return Math.ceil(1.33*(e.byteLength||e.size));{var i=e;let n=0,r=0;for(let e=0,t=i.length;e<t;e++)(n=i.charCodeAt(e))<128?r+=1:n<2048?r+=2:n<55296||57344<=n?r+=3:(e++,r+=4);return r}}(n)),0<e&&t>this.maxPayload)return this.writeBuffer.slice(0,e);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,r){"function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState&&((n=n||{}).compress=!1!==n.compress,this.emitReserved("packetCreate",e={type:e,data:t,options:n}),this.writeBuffer.push(e),r&&this.once("flush",r),this.flush())}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{(this.upgrading?n:e)()}):(this.upgrading?n:e)()),this}onError(e){ke.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;for(var r=e.length;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}ke.protocol=4;const Te="function"==typeof ArrayBuffer,Ee=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Re=Object.prototype.toString,Pe="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Re.call(Blob),xe="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Re.call(File);function Oe(e){return Te&&(e instanceof ArrayBuffer||Ee(e))||Pe&&e instanceof Blob||xe&&e instanceof File}function Ie(e){var t=[],n=e.data;const r=e;return r.data=function t(n,r){if(!n)return n;{if(Oe(n)){const e={_placeholder:!0,num:r.length};return r.push(n),e}if(Array.isArray(n)){const i=new Array(n.length);for(let e=0;e<n.length;e++)i[e]=t(n[e],r);return i}if("object"==typeof n&&!(n instanceof Date)){const s={};for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(s[o]=t(n[o],r));return s}}return n}(n,t),r.attachments=t.length,{packet:r,buffers:t}}function De(e,t){return e.data=function t(n,r){if(!n)return n;{if(n&&n._placeholder)return r[n.num];if(Array.isArray(n))for(let e=0;e<n.length;e++)n[e]=t(n[e],r);else if("object"==typeof n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&(n[e]=t(n[e],r))}return n}(e.data,t),e.attachments=void 0,e}var o,e;(e=o=o||{})[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK";class Ne extends r{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e)(t=this.decodeString(e)).type===o.BINARY_EVENT||t.type===o.BINARY_ACK?(this.reconstructor=new Le(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t);else{if(!Oe(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===o[n.type])throw new Error("unknown packet type "+n.type);if(n.type===o.BINARY_EVENT||n.type===o.BINARY_ACK){for(var r=t+1;"-"!==e.charAt(++t)&&t!=e.length;);r=e.substring(r,t);if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"===e.charAt(t+1)){for(r=t+1;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(r,t)}else n.nsp="/";r=e.charAt(t+1);if(""!==r&&Number(r)==r){for(r=t+1;++t;){var i=e.charAt(t);if(null==i||Number(i)!=i){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){r=this.tryParse(e.substr(t));if(!Ne.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case o.CONNECT:return"object"==typeof t;case o.DISCONNECT:return void 0===t;case o.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case o.EVENT:case o.BINARY_EVENT:return Array.isArray(t)&&0<t.length;case o.ACK:case o.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class Le{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){return this.buffers.push(e),this.buffers.length===this.reconPack.attachments?(e=De(this.reconPack,this.buffers),this.finishedReconstruction(),e):null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var Ae=Object.freeze({__proto__:null,protocol:5,get PacketType(){return o},Encoder:class{constructor(e){this.replacer=e}encode(e){return e.type!==o.EVENT&&e.type!==o.ACK||!function n(r){if(!r||"object"!=typeof r)return!1;if(Array.isArray(r)){for(let e=0,t=r.length;e<t;e++)if(n(r[e]))return!0;return!1}if(Oe(r))return!0;if(r.toJSON&&"function"==typeof r.toJSON&&1===arguments.length)return n(r.toJSON(),!0);for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e)&&n(r[e]))return!0;return!1}(e)?[this.encodeAsString(e)]:(e.type=e.type===o.EVENT?o.BINARY_EVENT:o.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return e.type!==o.BINARY_EVENT&&e.type!==o.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){var e=Ie(e),t=this.encodeAsString(e.packet);const n=e.buffers;return n.unshift(t),n}},Decoder:Ne});function a(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const je=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Me extends r{constructor(e,t,n){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){var e;this.subs||(e=this.io,this.subs=[a(e,"open",this.onopen.bind(this)),a(e,"packet",this.onpacket.bind(this)),a(e,"error",this.onerror.bind(this)),a(e,"close",this.onclose.bind(this))])}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(je.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);const n={type:o.EVENT,data:t};n.options={},n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(e=this.ids++,t=t.pop(),this._registerAckCallback(e,t),n.id=e);t=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!t||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(t,n){var e=this.flags.timeout;if(void 0===e)this.acks[t]=n;else{const r=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);n.call(this,new Error("operation has timed out"))},e);this.acks[t]=(...e)=>{this.io.clearTimeoutFn(r),n.apply(this,[null,...e])}}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this.packet({type:o.CONNECT,data:e})}):this.packet({type:o.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){var t;if(e.nsp===this.nsp)switch(e.type){case o.CONNECT:e.data&&e.data.sid?(t=e.data.sid,this.onconnect(t)):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case o.EVENT:case o.BINARY_EVENT:this.onevent(e);break;case o.ACK:case o.BINARY_ACK:this.onack(e);break;case o.DISCONNECT:this.ondisconnect();break;case o.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length)for(const t of this._anyListeners.slice())t.apply(this,e);super.emit.apply(this,e)}ack(t){const n=this;let r=!1;return function(...e){r||(r=!0,n.packet({type:o.ACK,id:t,data:e}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:o.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let e=0;e<n.length;e++)if(t===n[e])return n.splice(e,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let e=0;e<n.length;e++)if(t===n[e])return n.splice(e,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length)for(const t of this._anyOutgoingListeners.slice())t.apply(this,e.data)}}function Be(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&e.jitter<=1?e.jitter:0,this.attempts=0}Be.prototype.duration=function(){var e,t,n=this.ms*Math.pow(this.factor,this.attempts++);return this.jitter&&(e=Math.random(),t=Math.floor(e*this.jitter*n),n=0==(1&Math.floor(10*e))?n-t:n+t),0|Math.min(n,this.max)},Be.prototype.reset=function(){this.attempts=0},Be.prototype.setMin=function(e){this.ms=e},Be.prototype.setMax=function(e){this.max=e},Be.prototype.setJitter=function(e){this.jitter=e};class Ue extends r{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Z(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!=(n=t.randomizationFactor)?n:.5),this.backoff=new Be({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const r=t.parser||Ae;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null!=(t=this.backoff)&&t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null!=(t=this.backoff)&&t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null!=(t=this.backoff)&&t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new ke(this.uri,this.opts);const e=this.engine,n=this,r=(this._readyState="opening",this.skipReconnect=!1,a(e,"open",function(){n.onopen(),t&&t()}));var i=a(e,"error",e=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",e),t?t(e):n.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;0===s&&r();const o=this.setTimeoutFn(()=>{r(),e.close(),e.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&o.unref(),this.subs.push(function(){clearTimeout(o)})}return this.subs.push(r),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(a(e,"ping",this.onping.bind(this)),a(e,"data",this.ondata.bind(this)),a(e,"error",this.onerror.bind(this)),a(e,"close",this.onclose.bind(this)),a(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n||(n=new Me(this,e,t),this.nsps[e]=n),n}_destroy(e){for(const t of Object.keys(this.nsps)){const e=this.nsps[t];if(e.active)return}this._close()}_packet(t){var n=this.encoder.encode(t);for(let e=0;e<n.length;e++)this.engine.write(n[e],t.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var e=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open(e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()}))},e);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Fe={};function ze(e,t){"object"==typeof e&&(t=e,e=void 0);var e=function(e,t,n){let r=e;return n=n||"undefined"!=typeof location&&location,"string"==typeof(e=null==e?n.protocol+"//"+n.host:e)&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),r=_e(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/",e=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host,r.id=r.protocol+"://"+e+":"+r.port+t,r.href=r.protocol+"://"+e+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),n=e.source,r=e.id,i=e.path,i=Fe[r]&&i in Fe[r].nsps,i=t.forceNew||t["force new connection"]||!1===t.multiplex||i;let s;return s=i?new Ue(n,t):(Fe[r]||(Fe[r]=new Ue(n,t)),Fe[r]),e.query&&!t.query&&(t.query=e.queryKey),s.socket(e.path,t)}Object.assign(ze,{Manager:Ue,Socket:Me,io:ze,connect:ze});function Ve(e,t){return e(t={exports:{}},t.exports),t.exports}var t=Ve(function(e){var r={},i=(r.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),r.useArrayBufferView=!r.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),e.exports.binaryFeatures=r,e.exports.BlobBuilder);function t(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(i=e.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),t.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},t.prototype.flush=function(){var e;0<this._pieces.length&&(e=new Uint8Array(this._pieces),r.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[])},t.prototype.getBuffer=function(){if(this.flush(),r.useBlobBuilder){for(var e=new i,t=0,n=this._parts.length;t<n;t++)e.append(this._parts[t]);return e.getBlob()}return new Blob(this._parts)},e.exports.BufferBuilder=t}),He=(t.binaryFeatures,t.BlobBuilder,t.BufferBuilder,t.BufferBuilder),qe=t.binaryFeatures,We={unpack:function(e){return new c(e).unpack()},pack:function(e){var t=new l;return t.pack(e),t.getBuffer()}};function c(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function l(){this.bufferBuilder=new He}function Ge(e){e=e.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}c.prototype.unpack=function(){var e,t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},c.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},c.prototype.unpack_uint16=function(){var e=this.read(2),e=256*(255&e[0])+(255&e[1]);return this.index+=2,e},c.prototype.unpack_uint32=function(){var e=this.read(4),e=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,e},c.prototype.unpack_uint64=function(){var e=this.read(8),e=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,e},c.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},c.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},c.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},c.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},c.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},c.prototype.unpack_string=function(e){for(var t,n,r=this.read(e),i=0,s="";i<e;)(t=r[i])<128?(s+=String.fromCharCode(t),i++):(192^t)<32?(n=(192^t)<<6|63&r[i+1],s+=String.fromCharCode(n),i+=2):(n=(15&t)<<12|(63&r[i+1])<<6|63&r[i+2],s+=String.fromCharCode(n),i+=3);return this.index+=e,s},c.prototype.unpack_array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this.unpack();return t},c.prototype.unpack_map=function(e){for(var t={},n=0;n<e;n++){var r=this.unpack(),i=this.unpack();t[r]=i}return t},c.prototype.unpack_float=function(){var e=this.unpack_uint32();return(0==e>>31?1:-1)*(8388607&e|8388608)*Math.pow(2,(e>>23&255)-127-23)},c.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),n=(e>>20&2047)-1023;return(0==e>>31?1:-1)*((1048575&e|1048576)*Math.pow(2,n-20)+t*Math.pow(2,n-52))},c.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},l.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},l.prototype.pack=function(e){var t=typeof e;if("string"==t)this.pack_string(e);else if("number"==t)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"==t)!0===e?this.bufferBuilder.append(195):!1===e&&this.bufferBuilder.append(194);else if("undefined"==t)this.bufferBuilder.append(192);else{if("object"!=t)throw new Error('Type "'+t+'" not yet supported');if(null===e)this.bufferBuilder.append(192);else{t=e.constructor;if(t==Array)this.pack_array(e);else if(t==Blob||t==File||e instanceof Blob||e instanceof File)this.pack_bin(e);else if(t==ArrayBuffer)qe.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)qe.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(t==Object||t.toString().startsWith("class"))this.pack_object(e);else if(t==Date)this.pack_string(e.toString());else{if("function"!=typeof e.toBinaryPack)throw new Error('Type "'+t.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},l.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},l.prototype.pack_string=function(e){var t=600<(t=e).length?new Blob([t]).size:t.replace(/[^\u0000-\u007F]/g,Ge).length;if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(e)},l.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var n=0;n<t;n++)this.pack(e[n])},l.prototype.pack_integer=function(e){if(-32<=e&&e<=127)this.bufferBuilder.append(255&e);else if(0<=e&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(-128<=e&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(0<=e&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(-32768<=e&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(0<=e&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(-2147483648<=e&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(-0x8000000000000000<=e&&e<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(0<=e&&e<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},l.prototype.pack_double=function(e){var t=0,n=(e<0&&(t=1,e=-e),Math.floor(Math.log(e)/Math.LN2)),e=e/Math.pow(2,n)-1,e=Math.floor(e*Math.pow(2,52)),r=Math.pow(2,32),t=t<<31|n+1023<<20|e/r&1048575,n=e%r;this.bufferBuilder.append(203),this.pack_int32(t),this.pack_int32(n)},l.prototype.pack_object=function(e){var t,n=Object.keys(e).length;if(n<=15)this.pack_uint8(128+n);else if(n<=65535)this.bufferBuilder.append(222),this.pack_uint16(n);else{if(!(n<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(n)}for(t in e)e.hasOwnProperty(t)&&(this.pack(t),this.pack(e[t]))},l.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},l.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},l.prototype.pack_uint32=function(e){e&=4294967295;this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},l.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),e=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},l.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},l.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},l.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},l.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),e=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)};let Je=!0,Ke=!0;function Ye(e,t,n){e=e.match(t);return e&&e.length>=n&&parseInt(e[n],10)}function $e(e,r,i){if(e.RTCPeerConnection){const t=e.RTCPeerConnection.prototype,s=t.addEventListener,o=(t.addEventListener=function(e,t){if(e!==r)return s.apply(this,arguments);var n=e=>{e=i(e);e&&(t.handleEvent?t.handleEvent(e):t(e))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(t,n),s.apply(this,[e,n])},t.removeEventListener);t.removeEventListener=function(e,t){if(e!==r||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);if(!this._eventMap[r].has(t))return o.apply(this,arguments);var n=this._eventMap[r].get(t);return this._eventMap[r].delete(t),0===this._eventMap[r].size&&delete this._eventMap[r],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,n])},Object.defineProperty(t,"on"+r,{get(){return this["_on"+r]},set(e){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),e&&this.addEventListener(r,this["_on"+r]=e)},enumerable:!0,configurable:!0})}}function Xe(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Je=e)?"adapter.js logging disabled":"adapter.js logging enabled"}function Qe(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Ke=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Ze(){"object"!=typeof window||Je||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}function et(e,t){Ke&&console.warn(e+" is deprecated, please use "+t+" instead.")}function tt(e){return"[object Object]"===Object.prototype.toString.call(e)}function nt(n,t,e){const r=e?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const s=[];return n.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)}),s.forEach(t=>{n.forEach(e=>{e.type===r&&e.trackId===t.id&&!function t(n,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(e=>{e.endsWith("Id")?t(n,n.get(r[e]),i):e.endsWith("Ids")&&r[e].forEach(e=>{t(n,n.get(e),i)})}))}(n,e,i)})}),i}const rt=Ze;function it(e,t){const o=e&&e.navigator;if(o.mediaDevices){const a=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const i={};return Object.keys(e).forEach(t=>{if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){const n="object"==typeof e[t]?e[t]:{ideal:e[t]},r=(void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact),function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t});if(void 0!==n.ideal){i.optional=i.optional||[];let e={};"number"==typeof n.ideal?(e[r("min",t)]=n.ideal,i.optional.push(e),(e={})[r("max",t)]=n.ideal):e[r("",t)]=n.ideal,i.optional.push(e)}void 0!==n.exact&&"number"!=typeof n.exact?(i.mandatory=i.mandatory||{},i.mandatory[r("",t)]=n.exact):["min","max"].forEach(e=>{void 0!==n[e]&&(i.mandatory=i.mandatory||{},i.mandatory[r(e,t)]=n[e])})}}),e.advanced&&(i.optional=(i.optional||[]).concat(e.advanced)),i},r=function(i,s){if(61<=t.version)return s(i);if((i=JSON.parse(JSON.stringify(i)))&&"object"==typeof i.audio&&((e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])})((i=JSON.parse(JSON.stringify(i))).audio,"autoGainControl","googAutoGainControl"),e(i.audio,"noiseSuppression","googNoiseSuppression"),i.audio=a(i.audio)),i&&"object"==typeof i.video){let r=i.video.facingMode;r=r&&("object"==typeof r?r:{ideal:r});var e=t.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!o.mediaDevices.getSupportedConstraints||!o.mediaDevices.getSupportedConstraints().facingMode||e)){delete i.video.facingMode;let n;if("environment"===r.exact||"environment"===r.ideal?n=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(n=["front"]),n)return o.mediaDevices.enumerateDevices().then(e=>{let t=(e=e.filter(e=>"videoinput"===e.kind)).find(t=>n.some(e=>t.label.toLowerCase().includes(e)));return(t=!t&&e.length&&n.includes("back")?e[e.length-1]:t)&&(i.video.deviceId=r.exact?{exact:t.deviceId}:{ideal:t.deviceId}),i.video=a(i.video),rt("chrome: "+JSON.stringify(i)),s(i)})}i.video=a(i.video)}return rt("chrome: "+JSON.stringify(i)),s(i)},i=function(e){return 64<=t.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(o.getUserMedia=function(e,t,n){r(e,e=>{o.webkitGetUserMedia(e,t,e=>{n&&n(i(e))})})}.bind(o),o.mediaDevices.getUserMedia){const n=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(e){return r(e,t=>n(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(i(e))))}}}}function st(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function ot(i){if("object"!=typeof i||!i.RTCPeerConnection||"ontrack"in i.RTCPeerConnection.prototype)$e(i,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e));else{Object.defineProperty(i.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const e=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",t=>{let e;e=i.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===t.track.id):{track:t.track};const n=new Event("track");n.track=t.track,n.receiver=e,n.transceiver={receiver:e},n.streams=[r.stream],this.dispatchEvent(n)}),r.stream.getTracks().forEach(t=>{let e;e=i.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===t.id):{track:t};const n=new Event("track");n.track=t,n.receiver=e,n.transceiver={receiver:e},n.streams=[r.stream],this.dispatchEvent(n)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}}function at(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const r=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack,s=(e.RTCPeerConnection.prototype.addTrack=function(e,t){let n=i.apply(this,arguments);return n||(n=r(this,e),this._senders.push(n)),n},e.RTCPeerConnection.prototype.removeTrack);e.RTCPeerConnection.prototype.removeTrack=function(e){s.apply(this,arguments);e=this._senders.indexOf(e);-1!==e&&this._senders.splice(e,1)}}const t=e.RTCPeerConnection.prototype.addStream,n=(e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],t.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(r(this,e))})},e.RTCPeerConnection.prototype.removeStream);e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(t=>{var e=this._senders.find(e=>e.track===t);e&&this._senders.splice(this._senders.indexOf(e),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=o.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ct(e){if(e.RTCPeerConnection){const s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,t,n]=arguments;if(0<arguments.length&&"function"==typeof e)return s.apply(this,arguments);if(0===s.length&&(0===arguments.length||"function"!=typeof e))return s.apply(this,[]);const r=function(e){const r={},t=e.result();return t.forEach(t=>{const n={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(e=>{n[e]=t.stat(e)}),r[n.id]=n}),r},i=function(t){return new Map(Object.keys(t).map(e=>[e,t[e]]))};return 2<=arguments.length?s.apply(this,[function(e){t(i(r(e)))},e]):new Promise((t,e)=>{s.apply(this,[function(e){t(i(r(e)))},e])}).then(t,n)}}}function lt(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders,n=(t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),e.RTCPeerConnection.prototype.addTrack);n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const t=this;return this._pc.getStats().then(e=>nt(e,t.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=r.apply(this,[]);return e.forEach(e=>e._pc=this),e}),$e(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const t=this;return this._pc.getStats().then(e=>nt(e,t.track,!1))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){const s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let t,n,r;return this.getSenders().forEach(e=>{e.track===i&&(t?r=!0:t=e)}),this.getReceivers().forEach(e=>(e.track===i&&(n?r=!0:n=e),e.track===i)),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}}}}function dt(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const r=e.RTCPeerConnection.prototype.addTrack,i=(e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=r.apply(this,arguments);return this._shimmedLocalStreams[t.id]?-1===this._shimmedLocalStreams[t.id].indexOf(n)&&this._shimmedLocalStreams[t.id].push(n):this._shimmedLocalStreams[t.id]=[t,n],n},e.RTCPeerConnection.prototype.addStream),t=(e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(t=>{if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();i.apply(this,arguments);var n=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(n)},e.RTCPeerConnection.prototype.removeStream),s=(e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],t.apply(this,arguments)},e.RTCPeerConnection.prototype.removeTrack);e.RTCPeerConnection.prototype.removeTrack=function(n){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},n&&Object.keys(this._shimmedLocalStreams).forEach(e=>{var t=this._shimmedLocalStreams[e].indexOf(n);-1!==t&&this._shimmedLocalStreams[e].splice(t,1),1===this._shimmedLocalStreams[e].length&&delete this._shimmedLocalStreams[e]}),s.apply(this,arguments)}}function pt(s,e){if(s.RTCPeerConnection){if(s.RTCPeerConnection.prototype.addTrack&&65<=e.version)return dt(s);const t=s.RTCPeerConnection.prototype.getLocalStreams,n=(s.RTCPeerConnection.prototype.getLocalStreams=function(){const e=t.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])},s.RTCPeerConnection.prototype.addStream),i=(s.RTCPeerConnection.prototype.addStream=function(e){var t;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach(t=>{if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[e.id]||(t=new s.MediaStream(e.getTracks()),this._streams[e.id]=t,this._reverseStreams[t.id]=e,e=t),n.apply(this,[e])},s.RTCPeerConnection.prototype.removeStream),o=(s.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[(this._streams[e.id]||e).id],delete this._streams[e.id]},s.RTCPeerConnection.prototype.addTrack=function(t,e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var r;if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[e.id];return i?(i.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))})):(r=new s.MediaStream([t]),this._streams[e.id]=r,this._reverseStreams[r.id]=e,this.addStream(r)),this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(e){const n=s.RTCPeerConnection.prototype[e];s.RTCPeerConnection.prototype[e]={[e](){const t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[e=>{e=r(this,e);t[0].apply(null,[e])},e=>{t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then(e=>r(this,e))}}[e]}),s.RTCPeerConnection.prototype.setLocalDescription),a=(s.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type&&(arguments[0]=function(n,e){let r=e.sdp;return Object.keys(n._reverseStreams||[]).forEach(e=>{var e=n._reverseStreams[e],t=n._streams[e.id];r=r.replace(new RegExp(e.id,"g"),t.id)}),new RTCSessionDescription({type:e.type,sdp:r})}(this,arguments[0])),o.apply(this,arguments)},Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription"));function r(n,e){let r=e.sdp;return Object.keys(n._reverseStreams||[]).forEach(e=>{var e=n._reverseStreams[e],t=n._streams[e.id];r=r.replace(new RegExp(t.id,"g"),e.id)}),new RTCSessionDescription({type:e.type,sdp:r})}Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){var e=a.get.apply(this);return""===e.type?e:r(this,e)}}),s.RTCPeerConnection.prototype.removeTrack=function(t){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(t._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let n;Object.keys(this._streams).forEach(e=>{this._streams[e].getTracks().find(e=>t.track===e)&&(n=this._streams[e])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function ht(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const t=n.RTCPeerConnection.prototype[e];n.RTCPeerConnection.prototype[e]={[e](){return arguments[0]=new("addIceCandidate"===e?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}}[e]})}function ut(e,n){$e(e,"negotiationneeded",e=>{const t=e.target;if(!(n.version<72||t.getConfiguration&&"plan-b"===t.getConfiguration().sdpSemantics)||"stable"===t.signalingState)return e})}var ft=Object.freeze({__proto__:null,shimMediaStream:st,shimOnTrack:ot,shimGetSendersWithDtmf:at,shimGetStats:ct,shimSenderReceiverGetStats:lt,shimAddTrackRemoveTrackWithNative:dt,shimAddTrackRemoveTrack:pt,shimPeerConnection:ht,fixNegotiationNeeded:ut,shimGetUserMedia:it,shimGetDisplayMedia:function(s,e){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&("function"!=typeof e?console.error("shimGetDisplayMedia: getSourceId argument is not a function"):s.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(e=>{var t=i.video&&i.video.width,n=i.video&&i.video.height,r=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:r||3}},t&&(i.video.mandatory.maxWidth=t),n&&(i.video.mandatory.maxHeight=n),s.navigator.mediaDevices.getUserMedia(i)})})}});var I=Ve(function(e){var l={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};l.localCName=l.generateIdentifier(),l.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},l.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},l.getDescription=function(e){e=l.splitSections(e);return e&&e[0]},l.getMediaSections=function(e){e=l.splitSections(e);return e.shift(),e},l.matchPrefix=function(e,t){return l.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},l.parseCandidate=function(e){for(var t=(0===e.indexOf("a=candidate:")?e.substring(12):e.substring(10)).split(" "),n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},l.writeCandidate=function(e){var t=[],n=(t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port),e.type);return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},l.parseIceOptions=function(e){return e.substr(14).split(" ")},l.parseRtpMap=function(e){var e=e.substr(9).split(" "),t={payloadType:parseInt(e.shift(),10)},e=e[0].split("/");return t.name=e[0],t.clockRate=parseInt(e[1],10),t.channels=3===e.length?parseInt(e[2],10):1,t.numChannels=t.channels,t},l.writeRtpMap=function(e){var t=e.payloadType,n=(void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),e.channels||e.numChannels||1);return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},l.parseExtmap=function(e){e=e.substr(9).split(" ");return{id:parseInt(e[0],10),direction:0<e[0].indexOf("/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},l.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},l.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},l.writeFmtp=function(t){var n,e="",r=t.payloadType;return void 0!==t.preferredPayloadType&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length&&(n=[],Object.keys(t.parameters).forEach(function(e){t.parameters[e]?n.push(e+"="+t.parameters[e]):n.push(e)}),e+="a=fmtp:"+r+" "+n.join(";")+"\r\n"),e},l.parseRtcpFb=function(e){e=e.substr(e.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},l.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},l.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return-1<r?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},l.parseSsrcGroup=function(e){e=e.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(function(e){return parseInt(e,10)})}},l.getMid=function(e){e=l.matchPrefix(e,"a=mid:")[0];if(e)return e.substr(6)},l.parseFingerprint=function(e){e=e.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},l.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:l.matchPrefix(e+t,"a=fingerprint:").map(l.parseFingerprint)}},l.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},l.parseCryptoLine=function(e){e=e.substr(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},l.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?l.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},l.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;e=e.substr(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},l.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},l.getCryptoParameters=function(e,t){return l.matchPrefix(e+t,"a=crypto:").map(l.parseCryptoLine)},l.getIceParameters=function(e,t){var n=l.matchPrefix(e+t,"a=ice-ufrag:")[0],e=l.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&e?{usernameFragment:n.substr(12),password:e.substr(10)}:null},l.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},l.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=l.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var i=n[r],s=l.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){var o=l.parseRtpMap(s),s=l.matchPrefix(e,"a=fmtp:"+i+" ");switch(o.parameters=s.length?l.parseFmtp(s[0]):{},o.rtcpFeedback=l.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(l.parseRtcpFb),t.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(o.name.toUpperCase())}}}return l.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(l.parseExtmap(e))}),t},l.writeRtpDescription=function(e,t){var n="",r=(n=(n=(n=(n+="m="+e+" ")+(0<t.codecs.length?"9":"0")+" UDP/TLS/RTP/SAVPF ")+(t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n"))+"c=IN IP4 0.0.0.0\r\n"+"a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n=(n=(n+=l.writeRtpMap(e))+l.writeFmtp(e))+l.writeRtcpFb(e)}),0);return t.codecs.forEach(function(e){e.maxptime>r&&(r=e.maxptime)}),0<r&&(n+="a=maxptime:"+r+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=l.writeExtmap(e)}),n},l.parseRtpEncodingParameters=function(e){var t,n=[],r=l.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),s=-1!==r.fecMechanisms.indexOf("ULPFEC"),o=l.matchPrefix(e,"a=ssrc:").map(function(e){return l.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),a=0<o.length&&o[0].ssrc,o=l.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})}),c=(0<o.length&&1<o[0].length&&o[0][0]===a&&(t=o[0][1]),r.codecs.forEach(function(e){"RTX"===e.name.toUpperCase()&&e.parameters.apt&&(e={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)},a&&t&&(e.rtx={ssrc:t}),n.push(e),i&&((e=JSON.parse(JSON.stringify(e))).fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},n.push(e)))}),0===n.length&&a&&n.push({ssrc:a}),l.matchPrefix(e,"b="));return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=c})),n},l.parseRtcpParameters=function(e){var t={},n=l.matchPrefix(e,"a=ssrc:").map(function(e){return l.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0],n=(n&&(t.cname=n.value,t.ssrc=n.ssrc),l.matchPrefix(e,"a=rtcp-rsize")),n=(t.reducedSize=0<n.length,t.compound=0===n.length,l.matchPrefix(e,"a=rtcp-mux"));return t.mux=0<n.length,t},l.parseMsid=function(e){var t,n=l.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};n=l.matchPrefix(e,"a=ssrc:").map(function(e){return l.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<n.length?{stream:(t=n[0].value.split(" "))[0],track:t[1]}:void 0},l.parseSctpDescription=function(e){var t,n=l.parseMLine(e),r=l.matchPrefix(e,"a=max-message-size:"),r=(0<r.length&&(t=parseInt(r[0].substr(19),10)),isNaN(t)&&(t=65536),l.matchPrefix(e,"a=sctp-port:"));return 0<r.length?{port:parseInt(r[0].substr(12),10),protocol:n.fmt,maxMessageSize:t}:0<l.matchPrefix(e,"a=sctpmap:").length?(r=l.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" "),{port:parseInt(r[0],10),protocol:r[1],maxMessageSize:t}):void 0},l.writeSctpDescription=function(e,t){var n=[],n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"];return void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},l.generateSessionId=function(){return Math.random().toString().substr(2,21)},l.writeSessionBoilerplate=function(e,t,n){t=void 0!==t?t:2,e=e||l.generateSessionId();return"v=0\r\no="+(n||"thisisadapterortc")+" "+e+" "+t+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},l.writeMediaSection=function(e,t,n,r){t=l.writeRtpDescription(e.kind,t);return t=(t=(t+=l.writeIceParameters(e.iceGatherer.getLocalParameters()))+l.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"))+("a=mid:"+e.mid+"\r\n"),e.direction?t+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?t+="a=sendrecv\r\n":e.rtpSender?t+="a=sendonly\r\n":e.rtpReceiver?t+="a=recvonly\r\n":t+="a=inactive\r\n",e.rtpSender&&(t=t+"a="+(n="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n")+"a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+n,e.sendEncodingParameters[0].rtx&&(t=(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+n)+"a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+"\r\n"),t},l.getDirection=function(e,t){for(var n=l.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?l.getDirection(t):"sendrecv"},l.getKind=function(e){return l.splitLines(e)[0].split(" ")[0].substr(2)},l.isRejected=function(e){return"0"===e.split(" ",2)[1]},l.parseMLine=function(e){e=l.splitLines(e)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},l.parseOLine=function(e){e=l.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},l.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=l.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},e.exports=l});function mt(e,t,n,r,i){t=I.writeRtpDescription(e.kind,t);return t=(t=(t+=I.writeIceParameters(e.iceGatherer.getLocalParameters()))+I.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"))+("a=mid:"+e.mid+"\r\n"),e.rtpSender&&e.rtpReceiver?t+="a=sendrecv\r\n":e.rtpSender?t+="a=sendonly\r\n":e.rtpReceiver?t+="a=recvonly\r\n":t+="a=inactive\r\n",e.rtpSender&&(n=e.rtpSender._initialTrackId||e.rtpSender.track.id,e.rtpSender._initialTrackId=n,t=t+"a="+(i="msid:"+(r?r.id:"-")+" "+n+"\r\n")+"a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+i,e.sendEncodingParameters[0].rtx&&(t=(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+i)+"a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+I.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+I.localCName+"\r\n"),t}function gt(r,i){function s(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]}var o={codecs:[],headerExtensions:[],fecMechanisms:[]};return r.codecs.forEach(function(n){for(var e=0;e<i.codecs.length;e++){var t=i.codecs[e];if(n.name.toLowerCase()===t.name.toLowerCase()&&n.clockRate===t.clockRate&&("rtx"!==n.name.toLowerCase()||!n.parameters||!t.parameters.apt||function(e,t,n,r){e=s(e.parameters.apt,n),n=s(t.parameters.apt,r);return e&&n&&e.name.toLowerCase()===n.name.toLowerCase()}(n,t,r.codecs,i.codecs))){(t=JSON.parse(JSON.stringify(t))).numChannels=Math.min(n.numChannels,t.numChannels),o.codecs.push(t),t.rtcpFeedback=t.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),r.headerExtensions.forEach(function(e){for(var t=0;t<i.headerExtensions.length;t++){var n=i.headerExtensions[t];if(e.uri===n.uri){o.headerExtensions.push(n);break}}}),o}function vt(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function yt(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function h(e,t){t=new Error(t);return t.name=e,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],t}function bt(P,x){function O(e,t){t.addTrack(e),t.dispatchEvent(new P.MediaStreamTrackEvent("addtrack",{track:e}))}function i(e,t,n,r){var i=new Event("track");i.track=t,i.receiver=n,i.transceiver={receiver:n},i.streams=r,P.setTimeout(function(){e._dispatchEvent("track",i)})}function r(e){var t,r,i,n=this,s=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=s[e].bind(s)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",e=JSON.parse(JSON.stringify(e||{})),this.usingBundle="max-bundle"===e.bundlePolicy,"negotiate"===e.rtcpMuxPolicy)throw h("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(e.rtcpMuxPolicy||(e.rtcpMuxPolicy="require"),e.iceTransportPolicy){case"all":case"relay":break;default:e.iceTransportPolicy="all"}switch(e.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:e.bundlePolicy="balanced"}if(e.iceServers=(t=e.iceServers||[],r=x,i=!1,(t=JSON.parse(JSON.stringify(t))).filter(function(e){var t,n;if(e&&(e.urls||e.url))return n=e.urls||e.url,e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead."),n=(n=(t="string"==typeof n)?[n]:n).filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||i?0===e.indexOf("stun:")&&14393<=r&&-1===e.indexOf("?transport=udp"):i=!0}),delete e.url,e.urls=t?n[0]:n,!!n.length})),this._iceGatherers=[],e.iceCandidatePoolSize)for(var o=e.iceCandidatePoolSize;0<o;o--)this._iceGatherers.push(new P.RTCIceGatherer({iceServers:e.iceServers,gatherPolicy:e.iceTransportPolicy}));else e.iceCandidatePoolSize=0;this._config=e,this.transceivers=[],this._sdpSessionId=I.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1}Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},r.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(e,t){var n=0<this.transceivers.length,e={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};return this.usingBundle&&n?(e.iceTransport=this.transceivers[0].iceTransport,e.dtlsTransport=this.transceivers[0].dtlsTransport):(n=this._createIceAndDtlsTransports(),e.iceTransport=n.iceTransport,e.dtlsTransport=n.dtlsTransport),t||this.transceivers.push(e),e},r.prototype.addTrack=function(t,e){if(this._isClosed)throw h("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw h("InvalidAccessError","Track already exists.");for(var r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==t.kind||(n=this.transceivers[r]);return n=n||this._createTransceiver(t.kind),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(e)&&this.localStreams.push(e),n.track=t,n.stream=e,n.rtpSender=new P.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},r.prototype.addStream=function(t){var r,n=this;15025<=x?t.getTracks().forEach(function(e){n.addTrack(e,t)}):(r=t.clone(),t.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)}))},r.prototype.removeTrack=function(t){if(this._isClosed)throw h("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof P.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var e=this.transceivers.find(function(e){return e.rtpSender===t});if(!e)throw h("InvalidAccessError","Sender was not created by this connection.");var n=e.stream;e.rtpSender.stop(),e.rtpSender=null,e.track=null,e.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&-1<this.localStreams.indexOf(n)&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(e){var n=this;e.getTracks().forEach(function(t){var e=n.getSenders().find(function(e){return e.track===t});e&&n.removeTrack(e)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},r.prototype._createIceGatherer=function(n,e){var r=this;if(e&&0<n)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new P.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[n].bufferedCandidateEvents=[],this.transceivers[n].bufferCandidates=function(e){var t=!e.candidate||0===Object.keys(e.candidate).length;i.state=t?"completed":"gathering",null!==r.transceivers[n].bufferedCandidateEvents&&r.transceivers[n].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[n].bufferCandidates),i},r.prototype._gather=function(r,i){var e,s=this,o=this.transceivers[i].iceGatherer;o.onlocalcandidate||(e=this.transceivers[i].bufferedCandidateEvents,this.transceivers[i].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[i].bufferCandidates),o.onlocalcandidate=function(e){var t,n;s.usingBundle&&0<i||((t=new Event("icecandidate")).candidate={sdpMid:r,sdpMLineIndex:i},(n=!(e=e.candidate)||0===Object.keys(e).length)?"new"!==o.state&&"gathering"!==o.state||(o.state="completed"):("new"===o.state&&(o.state="gathering"),e.component=1,e.ufrag=o.getLocalParameters().usernameFragment,e=I.writeCandidate(e),t.candidate=Object.assign(t.candidate,I.parseCandidate(e)),t.candidate.candidate=e,t.candidate.toJSON=function(){return{candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex,usernameFragment:t.candidate.usernameFragment}}),(e=I.getMediaSections(s._localDescription.sdp))[t.candidate.sdpMLineIndex]+=n?"a=end-of-candidates\r\n":"a="+t.candidate.candidate+"\r\n",s._localDescription.sdp=I.getDescription(s._localDescription.sdp)+e.join(""),e=s.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}),"gathering"!==s.iceGatheringState&&(s.iceGatheringState="gathering",s._emitGatheringStateChange()),n||s._dispatchEvent("icecandidate",t),e&&(s._dispatchEvent("icecandidate",new Event("icecandidate")),s.iceGatheringState="complete",s._emitGatheringStateChange()))},P.setTimeout(function(){e.forEach(function(e){o.onlocalcandidate(e)})},0))},r.prototype._createIceAndDtlsTransports=function(){var e=this,t=new P.RTCIceTransport(null),n=(t.onicestatechange=function(){e._updateIceConnectionState(),e._updateConnectionState()},new P.RTCDtlsTransport(t));return n.ondtlsstatechange=function(){e._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:n}},r.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer,t=(t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer),this.transceivers[e].iceTransport),t=(t&&(delete t.onicestatechange,delete this.transceivers[e].iceTransport),this.transceivers[e].dtlsTransport);t&&(delete t.ondtlsstatechange,delete t.onerror,delete this.transceivers[e].dtlsTransport)},r.prototype._transceive=function(e,t,n){var r=gt(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(r.encodings=e.sendEncodingParameters,r.rtcp={cname:I.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(r.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(r)),n&&e.rtpReceiver&&0<r.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&x<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?r.encodings=e.recvEncodingParameters:r.encodings=[{}],r.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(r.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(r.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(r))},r.prototype.setLocalDescription=function(e){var t,l,d,p=this;return-1===["offer","answer"].indexOf(e.type)?Promise.reject(h("TypeError",'Unsupported type "'+e.type+'"')):!vt("setLocalDescription",e.type,p.signalingState)||p._isClosed?Promise.reject(h("InvalidStateError","Can not set local "+e.type+" in state "+p.signalingState)):("offer"===e.type?(t=I.splitSections(e.sdp),l=t.shift(),t.forEach(function(e,t){e=I.parseRtpParameters(e);p.transceivers[t].localCapabilities=e}),p.transceivers.forEach(function(e,t){p._gather(e.mid,t)})):"answer"===e.type&&(l=(t=I.splitSections(p._remoteDescription.sdp)).shift(),d=0<I.matchPrefix(l,"a=ice-lite").length,t.forEach(function(e,t){var n,r=p.transceivers[t],i=r.iceGatherer,s=r.iceTransport,o=r.dtlsTransport,a=r.localCapabilities,c=r.remoteCapabilities;I.isRejected(e)&&0===I.matchPrefix(e,"a=bundle-only").length||r.rejected||(n=I.getIceParameters(e,l),e=I.getDtlsParameters(e,l),d&&(e.role="server"),p.usingBundle&&0!==t||(p._gather(r.mid,t),"new"===s.state&&s.start(i,n,d?"controlling":"controlled"),"new"===o.state&&o.start(e)),t=gt(a,c),p._transceive(r,0<t.codecs.length,!1))})),p._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?p._updateSignalingState("have-local-offer"):p._updateSignalingState("stable"),Promise.resolve())},r.prototype.setRemoteDescription=function(w){var S=this;if(-1===["offer","answer"].indexOf(w.type))return Promise.reject(h("TypeError",'Unsupported type "'+w.type+'"'));if(!vt("setRemoteDescription",w.type,S.signalingState)||S._isClosed)return Promise.reject(h("InvalidStateError","Can not set remote "+w.type+" in state "+S.signalingState));var _={},k=(S.remoteStreams.forEach(function(e){_[e.id]=e}),[]),e=I.splitSections(w.sdp),T=e.shift(),E=0<I.matchPrefix(T,"a=ice-lite").length,R=0<I.matchPrefix(T,"a=group:BUNDLE ").length,t=(S.usingBundle=R,I.matchPrefix(T,"a=ice-options:")[0]);return S.canTrickleIceCandidates=!!t&&0<=t.substr(14).split(" ").indexOf("trickle"),e.forEach(function(e,t){var n,r,i,s,o,a,c,l,d,p,h,u,f,m=I.splitLines(e),g=I.getKind(e),v=I.isRejected(e)&&0===I.matchPrefix(e,"a=bundle-only").length,m=m[0].substr(2).split(" ")[2],y=I.getDirection(e,T),b=I.parseMsid(e),C=I.getMid(e)||I.generateIdentifier();v||"application"===g&&("DTLS/SCTP"===m||"UDP/DTLS/SCTP"===m)?S.transceivers[t]={mid:C,kind:g,protocol:m,rejected:!0}:(!v&&S.transceivers[t]&&S.transceivers[t].rejected&&(S.transceivers[t]=S._createTransceiver(g,!0)),m=I.parseRtpParameters(e),v||(s=I.getIceParameters(e,T),(o=I.getDtlsParameters(e,T)).role="client"),r=I.parseRtpEncodingParameters(e),a=I.parseRtcpParameters(e),c=0<I.matchPrefix(e,"a=end-of-candidates",T).length,e=I.matchPrefix(e,"a=candidate:").map(function(e){return I.parseCandidate(e)}).filter(function(e){return 1===e.component}),("offer"===w.type||"answer"===w.type)&&!v&&R&&0<t&&S.transceivers[t]&&(S._disposeIceAndDtlsTransports(t),S.transceivers[t].iceGatherer=S.transceivers[0].iceGatherer,S.transceivers[t].iceTransport=S.transceivers[0].iceTransport,S.transceivers[t].dtlsTransport=S.transceivers[0].dtlsTransport,S.transceivers[t].rtpSender&&S.transceivers[t].rtpSender.setTransport(S.transceivers[0].dtlsTransport),S.transceivers[t].rtpReceiver&&S.transceivers[t].rtpReceiver.setTransport(S.transceivers[0].dtlsTransport)),"offer"!==w.type||v?"answer"!==w.type||v||(v=(n=S.transceivers[t]).iceGatherer,u=n.iceTransport,l=n.dtlsTransport,f=n.rtpReceiver,d=n.sendEncodingParameters,i=n.localCapabilities,S.transceivers[t].recvEncodingParameters=r,S.transceivers[t].remoteCapabilities=m,S.transceivers[t].rtcpParameters=a,e.length&&"new"===u.state&&(!E&&!c||R&&0!==t?e.forEach(function(e){yt(n.iceTransport,e)}):u.setRemoteCandidates(e)),R&&0!==t||("new"===u.state&&u.start(v,s,"controlling"),"new"===l.state&&l.start(o)),!gt(n.localCapabilities,n.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&n.sendEncodingParameters[0].rtx&&delete n.sendEncodingParameters[0].rtx,S._transceive(n,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!f||"sendrecv"!==y&&"sendonly"!==y?delete n.rtpReceiver:(h=f.track,b?(_[b.stream]||(_[b.stream]=new P.MediaStream),O(h,_[b.stream]),k.push([h,f,_[b.stream]])):(_.default||(_.default=new P.MediaStream),O(h,_.default),k.push([h,f,_.default])))):((n=S.transceivers[t]||S._createTransceiver(g)).mid=C,n.iceGatherer||(n.iceGatherer=S._createIceGatherer(t,R)),e.length&&"new"===n.iceTransport.state&&(!c||R&&0!==t?e.forEach(function(e){yt(n.iceTransport,e)}):n.iceTransport.setRemoteCandidates(e)),i=P.RTCRtpReceiver.getCapabilities(g),x<15019&&(i.codecs=i.codecs.filter(function(e){return"rtx"!==e.name})),d=n.sendEncodingParameters||[{ssrc:1001*(2*t+2)}],u=!1,"sendrecv"===y||"sendonly"===y?(u=!n.rtpReceiver,f=n.rtpReceiver||new P.RTCRtpReceiver(n.dtlsTransport,g),u&&(h=f.track,(p=b&&"-"===b.stream?p:b?(_[b.stream]||(_[b.stream]=new P.MediaStream,Object.defineProperty(_[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(h,"id",{get:function(){return b.track}}),_[b.stream]):(_.default||(_.default=new P.MediaStream),_.default))&&(O(h,p),n.associatedRemoteMediaStreams.push(p)),k.push([h,f,p]))):n.rtpReceiver&&n.rtpReceiver.track&&(n.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===n.rtpReceiver.track.id});t&&(t=t,(e=e).removeTrack(t),e.dispatchEvent(new P.MediaStreamTrackEvent("removetrack",{track:t})))}),n.associatedRemoteMediaStreams=[]),n.localCapabilities=i,n.remoteCapabilities=m,n.rtpReceiver=f,n.rtcpParameters=a,n.sendEncodingParameters=d,n.recvEncodingParameters=r,S._transceive(S.transceivers[t],!1,u)))}),void 0===S._dtlsRole&&(S._dtlsRole="offer"===w.type?"active":"passive"),S._remoteDescription={type:w.type,sdp:w.sdp},"offer"===w.type?S._updateSignalingState("have-remote-offer"):S._updateSignalingState("stable"),Object.keys(_).forEach(function(e){var t,r=_[e];r.getTracks().length&&(-1===S.remoteStreams.indexOf(r)&&(S.remoteStreams.push(r),(t=new Event("addstream")).stream=r,P.setTimeout(function(){S._dispatchEvent("addstream",t)})),k.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&i(S,t,n,[r])}))}),k.forEach(function(e){e[2]||i(S,e[0],e[1],[])}),P.setTimeout(function(){S&&S.transceivers&&S.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(e){this.signalingState=e;e=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",e)},r.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,P.setTimeout(function(){var e;t.needNegotiation&&(t.needNegotiation=!1,e=new Event("negotiationneeded"),t._dispatchEvent("negotiationneeded",e))},0))},r.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState&&(this.iceConnectionState=e,e=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",e))},r.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState&&(this.connectionState=e,e=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",e))},r.prototype.createOffer=function(){var s=this;if(s._isClosed)return Promise.reject(h("InvalidStateError","Can not call createOffer after close"));var t=s.transceivers.filter(function(e){return"audio"===e.kind}).length,n=s.transceivers.filter(function(e){return"video"===e.kind}).length,e=arguments[0];if(e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(t=!0===e.offerToReceiveAudio?1:!1===e.offerToReceiveAudio?0:e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(n=!0===e.offerToReceiveVideo?1:!1===e.offerToReceiveVideo?0:e.offerToReceiveVideo)}for(s.transceivers.forEach(function(e){"audio"===e.kind?--t<0&&(e.wantReceive=!1):"video"===e.kind&&--n<0&&(e.wantReceive=!1)});0<t||0<n;)0<t&&(s._createTransceiver("audio"),t--),0<n&&(s._createTransceiver("video"),n--);var r=I.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++),e=(s.transceivers.forEach(function(e,t){var n=e.track,r=e.kind,i=e.mid||I.generateIdentifier(),i=(e.mid=i,e.iceGatherer||(e.iceGatherer=s._createIceGatherer(t,s.usingBundle)),P.RTCRtpSender.getCapabilities(r)),t=(x<15019&&(i.codecs=i.codecs.filter(function(e){return"rtx"!==e.name})),i.codecs.forEach(function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1"),e.remoteCapabilities&&e.remoteCapabilities.codecs&&e.remoteCapabilities.codecs.forEach(function(e){t.name.toLowerCase()===e.name.toLowerCase()&&t.clockRate===e.clockRate&&(t.preferredPayloadType=e.payloadType)})}),i.headerExtensions.forEach(function(t){(e.remoteCapabilities&&e.remoteCapabilities.headerExtensions||[]).forEach(function(e){t.uri===e.uri&&(t.id=e.id)})}),e.sendEncodingParameters||[{ssrc:1001*(2*t+1)}]);n&&15019<=x&&"video"===r&&!t[0].rtx&&(t[0].rtx={ssrc:t[0].ssrc+1}),e.wantReceive&&(e.rtpReceiver=new P.RTCRtpReceiver(e.dtlsTransport,r)),e.localCapabilities=i,e.sendEncodingParameters=t}),"max-compat"!==s._config.bundlePolicy&&(r+="a=group:BUNDLE "+s.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n",s.transceivers.forEach(function(e,t){r=r+mt(e,e.localCapabilities,"offer",e.stream,s._dtlsRole)+"a=rtcp-rsize\r\n",!e.iceGatherer||"new"===s.iceGatheringState||0!==t&&s.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,r+="a="+I.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(r+="a=end-of-candidates\r\n"))}),new P.RTCSessionDescription({type:"offer",sdp:r}));return Promise.resolve(e)},r.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(h("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(h("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var i=I.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++),s=(r.usingBundle&&(i+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),i+="a=ice-options:trickle\r\n",I.getMediaSections(r._remoteDescription.sdp).length),e=(r.transceivers.forEach(function(e,t){if(!(s<t+1)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?i+="m=application 0 DTLS/SCTP 5000\r\n":i+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?i+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(i+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(i+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");e.stream&&("audio"===e.kind?n=e.stream.getAudioTracks()[0]:"video"===e.kind&&(n=e.stream.getVideoTracks()[0]),n&&15019<=x&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var n,t=gt(e.localCapabilities,e.remoteCapabilities);!t.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=mt(e,t,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}}),new P.RTCSessionDescription({type:"answer",sdp:i}));return Promise.resolve(e)},r.prototype.addIceCandidate=function(a){var c,l=this;return a&&void 0===a.sdpMLineIndex&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(e,t){if(!l._remoteDescription)return t(h("InvalidStateError","Can not add ICE candidate without a remote description"));if(a&&""!==a.candidate){var n=a.sdpMLineIndex;if(a.sdpMid)for(var r=0;r<l.transceivers.length;r++)if(l.transceivers[r].mid===a.sdpMid){n=r;break}var i=l.transceivers[n];if(!i)return t(h("OperationError","Can not add ICE candidate"));if(i.rejected)return e();var s=0<Object.keys(a.candidate).length?I.parseCandidate(a.candidate):{};if("tcp"===s.protocol&&(0===s.port||9===s.port))return e();if(s.component&&1!==s.component)return e();if((0===n||0<n&&i.iceTransport!==l.transceivers[0].iceTransport)&&!yt(i.iceTransport,s))return t(h("OperationError","Can not add ICE candidate"));i=a.candidate.trim();0===i.indexOf("a=")&&(i=i.substr(2)),(c=I.getMediaSections(l._remoteDescription.sdp))[n]+="a="+(s.type?i:"end-of-candidates")+"\r\n",l._remoteDescription.sdp=I.getDescription(l._remoteDescription.sdp)+c.join("")}else for(var o=0;o<l.transceivers.length&&(l.transceivers[o].rejected||(l.transceivers[o].iceTransport.addRemoteCandidate({}),(c=I.getMediaSections(l._remoteDescription.sdp))[o]+="a=end-of-candidates\r\n",l._remoteDescription.sdp=I.getDescription(l._remoteDescription.sdp)+c.join(""),!l.usingBundle));o++);e()})},r.prototype.getStats=function(t){if(t&&t instanceof P.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),n)return n.getStats();throw h("InvalidAccessError","Invalid selector.")}var r=[];return this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){t[e]&&r.push(t[e].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(e){var t,e=P[e];e&&e.prototype&&e.prototype.getStats&&(t=e.prototype.getStats,e.prototype.getStats=function(){return t.apply(this).then(function(n){var r=new Map;return Object.keys(n).forEach(function(e){var t;n[e].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(t=n[e]).type]||t.type,r.set(e,n[e])}),r})})});var e=["createOffer","createAnswer"];return e.forEach(function(e){var n=r.prototype[e];r.prototype[e]=function(){var t=arguments;return"function"==typeof t[0]||"function"==typeof t[1]?n.apply(this,[arguments[2]]).then(function(e){"function"==typeof t[0]&&t[0].apply(null,[e])},function(e){"function"==typeof t[1]&&t[1].apply(null,[e])}):n.apply(this,arguments)}}),(e=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var n=r.prototype[e];r.prototype[e]=function(){var t=arguments;return"function"==typeof t[1]||"function"==typeof t[2]?n.apply(this,arguments).then(function(){"function"==typeof t[1]&&t[1].apply(null)},function(e){"function"==typeof t[2]&&t[2].apply(null,[e])}):n.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),r}function Ct(e){const t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(e=>Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e)))}}function wt(e){"getDisplayMedia"in e.navigator&&(!e.navigator.mediaDevices||e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function St(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(e){r.set.call(this,e);const t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const n=bt(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e){let r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(t=>{if(t&&(t.urls||t.url)){let e=t.urls||t.url;t.url&&!t.urls&&et("RTCIceServer.url","RTCIceServer.urls");var n="string"==typeof e;return e=(e=n?[e]:e).filter(e=>{if(0===e.indexOf("stun:"))return!1;e=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return e&&!r?r=!0:e&&!r}),delete t.url,t.urls=n?e[0]:e,!!e.length}})}(e.iceServers,t.version),Ze("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function _t(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var kt=Object.freeze({__proto__:null,shimPeerConnection:St,shimReplaceTrack:_t,shimGetUserMedia:Ct,shimGetDisplayMedia:wt});function Tt(e,t){const r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){et("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(55<t.version&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const i=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),s(e)},n&&n.prototype.getSettings){const o=n.prototype.getSettings;n.prototype.getSettings=function(){var e=o.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){const a=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[e])}}}}function Et(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Rt(n,r){if("object"==typeof n&&(n.RTCPeerConnection||n.mozRTCPeerConnection)){!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const t=n.RTCPeerConnection.prototype[e];n.RTCPeerConnection.prototype[e]={[e](){return arguments[0]=new("addIceCandidate"===e?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}}[e]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[e,t,n]=arguments;return s.apply(this,[e||null]).then(n=>{if(r.version<53&&!t)try{n.forEach(e=>{e.type=i[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;n.forEach((e,t)=>{n.set(t,Object.assign({},e,{type:i[e.type]||e.type}))})}return n}).then(t,n)}}}function Pt(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders,n=(t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),e.RTCPeerConnection.prototype.addTrack);n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function xt(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),$e(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function Ot(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){et("removeStream","removeTrack"),this.getSenders().forEach(e=>{e.track&&t.getTracks().includes(e.track)&&this.removeTrack(e)})})}function It(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Dt(e){if("object"==typeof e&&e.RTCPeerConnection){const s=e.RTCPeerConnection.prototype.addTransceiver;s&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1];var t=e&&"sendEncodings"in e,n=(t&&e.sendEncodings.forEach(e=>{if("rid"in e){const t=/^[a-z0-9]{0,16}$/i;if(!t.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(1<=parseFloat(e.scaleResolutionDownBy)))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(0<=parseFloat(e.maxFramerate)))throw new RangeError("max_framerate must be >= 0.0")}),s.apply(this,arguments));if(t){const r=n["sender"],i=r.getParameters();"encodings"in i&&(1!==i.encodings.length||0!==Object.keys(i.encodings[0]).length)||(i.encodings=e.sendEncodings,r.sendEncodings=e.sendEncodings,this.setParametersPromises.push(r.setParameters(i).then(()=>{delete r.sendEncodings}).catch(()=>{delete r.sendEncodings})))}return n})}}function Nt(e){if("object"==typeof e&&e.RTCRtpSender){const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function Lt(e){if("object"==typeof e&&e.RTCPeerConnection){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}}function At(e){if("object"==typeof e&&e.RTCPeerConnection){const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}}var jt=Object.freeze({__proto__:null,shimOnTrack:Et,shimPeerConnection:Rt,shimSenderGetStats:Pt,shimReceiverGetStats:xt,shimRemoveStream:Ot,shimRTCDataChannel:It,shimAddTransceiver:Dt,shimGetParameters:Nt,shimCreateOffer:Lt,shimCreateAnswer:At,shimGetUserMedia:Tt,shimGetDisplayMedia:function(n,r){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(e){if(e&&e.video)return!0===e.video?e.video={mediaSource:r}:e.video.mediaSource=r,n.navigator.mediaDevices.getUserMedia(e);{const t=new DOMException("getDisplayMedia without video constraints is undefined");return t.name="NotFoundError",t.code=8,Promise.reject(t)}})}});function Mt(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(e=>n.call(this,e,t)),t.getVideoTracks().forEach(e=>n.call(this,e,t))},e.RTCPeerConnection.prototype.addTrack=function(e,...t){return t&&t.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),n.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})}})}}function Bt(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams||[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),!this._remoteStreams.includes(e)){this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(e=>{if(n._remoteStreams||(n._remoteStreams=[]),!(0<=n._remoteStreams.indexOf(e))){n._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,n.dispatchEvent(t)}})}),t.apply(n,arguments)}}}function Ut(e){if("object"==typeof e&&e.RTCPeerConnection){const t=e.RTCPeerConnection.prototype,i=t.createOffer,s=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(e,t){var n=2<=arguments.length?arguments[2]:e;const r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){var n=2<=arguments.length?arguments[2]:e;const r=s.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};e=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=e,t.setRemoteDescription=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=function(e,t,n){const r=c.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r}}}function Ft(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const t=r.mediaDevices,n=t.getUserMedia.bind(t);r.mediaDevices.getUserMedia=e=>n(zt(e))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=function(e,t,n){r.mediaDevices.getUserMedia(e).then(t,n)}.bind(r))}function zt(e){return e&&void 0!==e.video?Object.assign({},e,{video:function i(s){return tt(s)?Object.keys(s).reduce(function(e,t){var n=(r=tt(s[t]))?i(s[t]):s[t],r=r&&!Object.keys(n).length;return void 0===n||r?e:Object.assign(e,{[t]:n})},{}):s}(e.video)}):e}function Vt(e){if(e.RTCPeerConnection){const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,e){if(n&&n.iceServers){const r=[];for(let t=0;t<n.iceServers.length;t++){let e=n.iceServers[t];!e.hasOwnProperty("urls")&&e.hasOwnProperty("url")?(et("RTCIceServer.url","RTCIceServer.urls"),(e=JSON.parse(JSON.stringify(e))).urls=e.url,delete e.url,r.push(e)):r.push(n.iceServers[t])}n.iceServers=r}return new t(n,e)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}}function Ht(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qt(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind),n=(!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo),this.getTransceivers().find(e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return r.apply(this,arguments)}}function Wt(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Gt=Object.freeze({__proto__:null,shimLocalStreamsAPI:Mt,shimRemoteStreamsAPI:Bt,shimCallbacksAPI:Ut,shimGetUserMedia:Ft,shimConstraints:zt,shimRTCIceServerUrls:Vt,shimTrackEventTransceiver:Ht,shimCreateOfferLegacy:qt,shimAudioContext:Wt});function Jt(t){if(t.RTCIceCandidate&&!(t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)){const i=t.RTCIceCandidate;t.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var t=new i(e),n=I.parseCandidate(e.candidate);const r=Object.assign(t,n);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new i(e)},t.RTCIceCandidate.prototype=i.prototype,$e(t,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e))}}function Kt(e,i){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===i.browser&&76<=i.version&&(t=this.getConfiguration()["sdpSemantics"],"plan-b"===t&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})),function(e){if(!e||!e.sdp)return!1;const t=I.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=I.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){var t=function(e){e=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||e.length<2)return-1;e=parseInt(e[1],10);return e!=e?-1:e}(arguments[0]),n=function(e){let t=65536;return t="firefox"===i.browser?i.version<57?-1===e?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637:t}(t),t=function(e,t){let n=65536;"firefox"===i.browser&&57===i.version&&(n=65535);const r=I.matchPrefix(e.sdp,"a=max-message-size:");return 0<r.length?n=parseInt(r[0].substr(19),10):"firefox"===i.browser&&-1!==t&&(n=2147483637),n}(arguments[0],t);let e;e=0===n&&0===t?Number.POSITIVE_INFINITY:0===n||0===t?Math.max(n,t):Math.min(n,t);n={};Object.defineProperty(n,"maxMessageSize",{get(){return e}}),this._sctp=n}return r.apply(this,arguments)}}}function Yt(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){const n=e.RTCPeerConnection.prototype.createDataChannel;function t(t,n){const r=t.send;t.send=function(){var e=arguments[0],e=e.length||e.size||e.byteLength;if("open"===t.readyState&&n.sctp&&e>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return r.apply(t,arguments)}}e.RTCPeerConnection.prototype.createDataChannel=function(){var e=n.apply(this,arguments);return t(e,this),e},$e(e,"datachannel",e=>(t(e.channel,e.target),e))}}function $t(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){const n=e.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const t=n[e];n[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;var n;return t._lastConnectionState!==t.connectionState&&(t._lastConnectionState=t.connectionState,n=new Event("connectionstatechange",e),t.dispatchEvent(n)),e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}})}}function Xt(n,e){if(n.RTCPeerConnection&&!("chrome"===e.browser&&71<=e.version||"safari"===e.browser&&605<=e.version)){const r=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t;return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(t=e.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n"),n.RTCSessionDescription&&e instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:e.type,sdp:t}):e.sdp=t),r.apply(this,arguments)}}}function Qt(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}var Zt=Object.freeze({__proto__:null,shimRTCIceCandidate:Jt,shimMaxMessageSize:Kt,shimSendThrowTypeError:Yt,shimConnectionState:$t,removeExtmapAllowMixed:Xt,shimAddIceCandidateNullOrEmpty:Qt});t=function({window:e},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=Ze;var r=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const n=e["navigator"];if(n.mozGetUserMedia)t.browser="firefox",t.version=Ye(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=Ye(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=Ye(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Ye(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e);const i={browserDetails:r,commonShim:Zt,extractVersion:Ye,disableLog:Xe,disableWarnings:Qe};switch(r.browser){case"chrome":if(!ft||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=ft,Qt(e,r),it(e,r),st(e),ht(e,r),ot(e),pt(e,r),at(e),ct(e),lt(e),ut(e,r),Jt(e),$t(e),Kt(e,r),Yt(e),Xt(e,r);break;case"firefox":if(!jt||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=jt,Qt(e,r),Tt(e,r),Rt(e,r),Et(e),Ot(e),Pt(e),xt(e),It(e),Dt(e),Nt(e),Lt(e),At(e),Jt(e),$t(e),Kt(e,r),Yt(e);break;case"edge":if(!kt||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),i;n("adapter.js shimming edge."),i.browserShim=kt,Ct(e),wt(e),St(e,r),_t(e),Kt(e,r),Yt(e);break;case"safari":if(!Gt||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=Gt,Qt(e,r),Vt(e),qt(e),Ut(e),Mt(e),Bt(e),Ht(e),Ft(e),Wt(e),Jt(e),Kt(e,r),Yt(e),Xt(e,r);break;default:n("Unsupported browser!")}return i}({window:"undefined"==typeof window?void 0:window});function d(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var en=t.default||t,tn=(nn.prototype.isWebRTCSupported=function(){return"undefined"!=typeof RTCPeerConnection},nn.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion();return!!this.supportedBrowsers.includes(e)&&("chrome"===e?t>=this.minChromeVersion:"firefox"===e?t>=this.minFirefoxVersion:"safari"===e&&(!this.isIOS&&t>=this.minSafariVersion))},nn.prototype.getBrowser=function(){return en.browserDetails.browser},nn.prototype.getVersion=function(){return en.browserDetails.version||0},nn.prototype.isUnifiedPlanSupported=function(){var e,t=this.getBrowser(),n=en.browserDetails.version||0;if("chrome"===t&&n<this.minChromeVersion)return!1;if("firefox"===t&&n>=this.minFirefoxVersion)return!0;if(!(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype))return!1;t=!1;try{(e=new RTCPeerConnection).addTransceiver("audio"),t=!0}catch(e){}finally{e&&e.close()}return t},nn.prototype.toString=function(){return"Supports:\n    browser:".concat(this.getBrowser(),"\n    version:").concat(this.getVersion(),"\n    isIOS:").concat(this.isIOS,"\n    isWebRTCSupported:").concat(this.isWebRTCSupported(),"\n    isBrowserSupported:").concat(this.isBrowserSupported(),"\n    isUnifiedPlanSupported:").concat(this.isUnifiedPlanSupported())},new nn);function nn(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}var rn={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};function sn(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=rn,this.browser=tn.getBrowser(),this.browserVersion=tn.getVersion(),this.supports=function(){var e,t={browser:tn.isBrowserSupported(),webRTC:tn.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;try{e=new RTCPeerConnection(rn),t.audioVideo=!0;var n=void 0;try{n=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!n.ordered;try{n.binaryType="blob",t.binaryBlob=!tn.isIOS}catch(e){}}catch(e){}finally{n&&n.close()}}catch(e){}finally{e&&e.close()}return t}(),this.pack=We.pack,this.unpack=We.unpack,this._dataCount=1}sn.prototype.noop=function(){},sn.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},sn.prototype.chunk=function(e){for(var t=[],n=e.size,r=Math.ceil(n/p.chunkedMTU),i=0,s=0;s<n;){var o=Math.min(n,s+p.chunkedMTU),a=e.slice(s,o),a={__peerData:this._dataCount,n:i,data:a,total:r};t.push(a),s=o,i++}return this._dataCount++,t},sn.prototype.blobToArrayBuffer=function(e,t){var n=new FileReader;return n.onload=function(e){e.target&&t(e.target.result)},n.readAsArrayBuffer(e),n},sn.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer},sn.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},sn.prototype.isSecure=function(){return"https:"===location.protocol};var p=new sn,t={},u=(d(t,"Peer",()=>Qn,e=>Qn=e),{}),on=Object.prototype.hasOwnProperty,f="~";function an(){}function cn(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function ln(e,t,n,r,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");n=new cn(n,r||e,i),r=f?f+t:t;return e._events[r]?e._events[r].fn?e._events[r]=[e._events[r],n]:e._events[r].push(n):(e._events[r]=n,e._eventsCount++),e}function dn(e,t){0==--e._eventsCount?e._events=new an:delete e._events[t]}function m(){this._events=new an,this._eventsCount=0}Object.create&&(an.prototype=Object.create(null),(new an).__proto__||(f=!1)),m.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)on.call(e,t)&&n.push(f?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},m.prototype.listeners=function(e){var e=f?f+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var n=0,r=t.length,i=new Array(r);n<r;n++)i[n]=t[n].fn;return i},m.prototype.listenerCount=function(e){e=f?f+e:e,e=this._events[e];return e?e.fn?1:e.length:0},m.prototype.emit=function(e,t,n,r,i,s){var o=f?f+e:e;if(!this._events[o])return!1;var a,c=this._events[o],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,s),!0}for(h=1,a=new Array(l-1);h<l;h++)a[h-1]=arguments[h];c.fn.apply(c.context,a)}else for(var d,p=c.length,h=0;h<p;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,n);break;case 4:c[h].fn.call(c[h].context,t,n,r);break;default:if(!a)for(d=1,a=new Array(l-1);d<l;d++)a[d-1]=arguments[d];c[h].fn.apply(c[h].context,a)}return!0},m.prototype.on=function(e,t,n){return ln(this,e,t,n,!1)},m.prototype.once=function(e,t,n){return ln(this,e,t,n,!0)},m.prototype.removeListener=function(e,t,n,r){e=f?f+e:e;if(!this._events[e])return this;if(!t)return dn(this,e),this;var i=this._events[e];if(i.fn)i.fn!==t||r&&!i.once||n&&i.context!==n||dn(this,e);else{for(var s=0,o=[],a=i.length;s<a;s++)(i[s].fn!==t||r&&!i[s].once||n&&i[s].context!==n)&&o.push(i[s]);o.length?this._events[e]=1===o.length?o[0]:o:dn(this,e)}return this},m.prototype.removeAllListeners=function(e){return e?(e=f?f+e:e,this._events[e]&&dn(this,e)):(this._events=new an,this._eventsCount=0),this},m.prototype.off=m.prototype.removeListener,m.prototype.addListener=m.prototype.on,m.prefixed=f;function pn(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function hn(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var g,u=m.EventEmitter=m,v={};d(v,"LogLevel",()=>g,e=>g=e),d(v,"default",()=>fn,e=>fn=e);function un(){this._logLevel=g.Disabled}(T=g=g||{})[T.Disabled=0]="Disabled",T[T.Errors=1]="Errors",T[T.Warnings=2]="Warnings",T[T.All=3]="All",Object.defineProperty(un.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),un.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=g.All&&this._print.apply(this,hn([g.All],pn(e),!1))},un.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=g.Warnings&&this._print.apply(this,hn([g.Warnings],pn(e),!1))},un.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=g.Errors&&this._print.apply(this,hn([g.Errors],pn(e),!1))},un.prototype.setLogFunction=function(e){this._print=e},un.prototype._print=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=hn(["PeerJS: "],pn(t),!1);for(r in i)i[r]instanceof Error&&(i[r]="("+i[r].name+") "+i[r].message);e>=g.All?console.log.apply(console,hn([],pn(i),!1)):e>=g.Warnings?console.warn.apply(console,hn(["WARNING"],pn(i),!1)):e>=g.Errors&&console.error.apply(console,hn(["ERROR"],pn(i),!1))};var y,b,C,w,S,fn=new un,mn={},gn=(d(mn,"Socket",()=>bn,e=>bn=e),(T=y=y||{}).Data="data",T.Media="media",(T=b=b||{}).BrowserIncompatible="browser-incompatible",T.Disconnected="disconnected",T.InvalidID="invalid-id",T.InvalidKey="invalid-key",T.Network="network",T.PeerUnavailable="peer-unavailable",T.SslUnavailable="ssl-unavailable",T.ServerError="server-error",T.SocketError="socket-error",T.SocketClosed="socket-closed",T.UnavailableID="unavailable-id",T.WebRTC="webrtc",(T=C=C||{}).Binary="binary",T.BinaryUTF8="binary-utf8",T.JSON="json",(T=w=w||{}).Message="message",T.Disconnected="disconnected",T.Error="error",T.Close="close",(T=S=S||{}).Heartbeat="HEARTBEAT",T.Candidate="CANDIDATE",T.Offer="OFFER",T.Answer="ANSWER",T.Open="OPEN",T.Error="ERROR",T.IdTaken="ID-TAKEN",T.InvalidKey="INVALID-KEY",T.Leave="LEAVE",T.Expire="EXPIRE",JSON.parse('{"name":"peerjs","version":"1.4.6","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"type":"module","sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.cjs","browser-unminified":"dist/peerjs.cjs","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"includeNodeModules":true,"context":"browser","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"includeNodeModules":true,"context":"browser","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build && cp dist/peerjs.cjs dist/peerjs.js && cp dist/peerjs.min.cjs dist/peerjs.min.js","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}'));vn=function(e,t){return(vn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}vn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(_,yn=u.EventEmitter),_.prototype.start=function(e,t){var n=this,e=(this._id=e,"".concat(this._baseUrl,"&id=").concat(e,"&token=").concat(t));!this._socket&&this._disconnected&&(this._socket=new WebSocket(e+"&version="+gn.version),this._disconnected=!1,this._socket.onmessage=function(t){var e;try{e=JSON.parse(t.data),v.default.log("Server message received:",e)}catch(e){return void v.default.log("Invalid server message",t.data)}n.emit(w.Message,e)},this._socket.onclose=function(e){n._disconnected||(v.default.log("Socket closed.",e),n._cleanup(),n._disconnected=!0,n.emit(w.Disconnected))},this._socket.onopen=function(){n._disconnected||(n._sendQueuedMessages(),v.default.log("Socket open"),n._scheduleHeartbeat())})},_.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout(function(){e._sendHeartbeat()},this.pingInterval)},_.prototype._sendHeartbeat=function(){var e;this._wsOpen()?(e=JSON.stringify({type:S.Heartbeat}),this._socket.send(e),this._scheduleHeartbeat()):v.default.log("Cannot send heartbeat, because socket closed")},_.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},_.prototype._sendQueuedMessages=function(){var t,e,n=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}([],function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}(this._messagesQueue),!1);this._messagesQueue=[];try{for(var r=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),i=r.next();!i.done;i=r.next()){var s=i.value;this.send(s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},_.prototype.send=function(e){var t;this._disconnected||(this._id?e.type?this._wsOpen()&&(t=JSON.stringify(e),this._socket.send(t)):this.emit(w.Error,"Invalid message"):this._messagesQueue.push(e))},_.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},_.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)};var vn,yn,bn=_;function _(e,t,n,r,i,s){void 0===s&&(s=5e3);var o=yn.call(this)||this,s=(o.pingInterval=s,o._disconnected=!0,o._messagesQueue=[],e?"wss://":"ws://");return o._baseUrl=s+t+":"+n+r+"peerjs?key="+i,o}function Cn(e,o,a,c){return new(a=a||Promise)(function(n,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,i)}s((c=c.apply(e,o||[])).next())})}function wn(r,i){var s,o,a,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(s)throw new TypeError("Generator is already executing.");for(;c;)try{if(s=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,o=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){c.label=t[1];break}if(6===t[0]&&c.label<a[1]){c.label=a[1],a=t;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(t);break}a[2]&&c.ops.pop(),c.trys.pop();continue}t=i.call(r,c)}catch(e){t=[6,e],o=0}finally{s=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}var Sn={},_n=(d(Sn,"MediaConnection",()=>Nn,e=>Nn=e),{}),kn=(d(_n,"Negotiator",()=>Tn,e=>Tn=e),function(){return(kn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}),Tn=(k.prototype.startConnection=function(e){var t,n,r=this._startPeerConnection();this.connection.peerConnection=r,this.connection.type===y.Media&&e._stream&&this._addTracksToConnection(e._stream,r),e.originator?(this.connection.type===y.Data&&(t=this.connection,n={ordered:!!e.reliable},r=r.createDataChannel(t.label,n),t.initialize(r)),this._makeOffer()):this.handleSDP("OFFER",e.sdp)},k.prototype._startPeerConnection=function(){v.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},k.prototype._setupListeners=function(e){var n=this,r=this.connection.peer,i=this.connection.connectionId,t=this.connection.type,s=this.connection.provider;v.default.log("Listening for ICE candidates."),e.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&(v.default.log("Received ICE candidates for ".concat(r,":"),e.candidate),s.socket.send({type:S.Candidate,payload:{candidate:e.candidate,type:t,connectionId:i},dst:r}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":v.default.log("iceConnectionState is failed, closing connections to "+r),n.connection.emit("error",new Error("Negotiation of connection to "+r+" failed.")),n.connection.close();break;case"closed":v.default.log("iceConnectionState is closed, closing connections to "+r),n.connection.emit("error",new Error("Connection to "+r+" closed.")),n.connection.close();break;case"disconnected":v.default.log("iceConnectionState changed to disconnected on the connection with "+r);break;case"completed":e.onicecandidate=p.noop}n.connection.emit("iceStateChanged",e.iceConnectionState)},v.default.log("Listening for data channel"),e.ondatachannel=function(e){v.default.log("Received data channel");e=e.channel;s.getConnection(r,i).initialize(e)},v.default.log("Listening for remote stream"),e.ontrack=function(e){v.default.log("Received remote stream");var e=e.streams[0],t=s.getConnection(r,i);t.type===y.Media&&n._addStreamToMediaConnection(e,t)}},k.prototype.cleanup=function(){v.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e,t,n,r=this.connection.peerConnection;r&&(this.connection.peerConnection=null,r.onicecandidate=r.oniceconnectionstatechange=r.ondatachannel=r.ontrack=function(){},e="closed"!==r.signalingState,t=!1,this.connection.type===y.Data&&(n=this.connection.dataChannel)&&(t=!!n.readyState&&"closed"!==n.readyState),(e||t)&&r.close())},k.prototype._makeOffer=function(){return Cn(this,void 0,Promise,function(){var t,n,r,i,s;return wn(this,function(e){switch(e.label){case 0:t=this.connection.peerConnection,n=this.connection.provider,e.label=1;case 1:return e.trys.push([1,7,,8]),[4,t.createOffer(this.connection.options.constraints)];case 2:r=e.sent(),v.default.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),e.label=3;case 3:return e.trys.push([3,5,,6]),[4,t.setLocalDescription(r)];case 4:return e.sent(),v.default.log("Set localDescription:",r,"for:".concat(this.connection.peer)),s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:p.browser},this.connection.type===y.Data&&(i=this.connection,s=kn(kn({},s),{label:i.label,reliable:i.reliable,serialization:i.serialization})),n.socket.send({type:S.Offer,payload:s,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(i=e.sent())&&(n.emitError(b.WebRTC,i),v.default.log("Failed to setLocalDescription, ",i)),[3,6];case 6:return[3,8];case 7:return s=e.sent(),n.emitError(b.WebRTC,s),v.default.log("Failed to createOffer, ",s),[3,8];case 8:return[2]}})})},k.prototype._makeAnswer=function(){return Cn(this,void 0,Promise,function(){var t,n,r,i;return wn(this,function(e){switch(e.label){case 0:t=this.connection.peerConnection,n=this.connection.provider,e.label=1;case 1:return e.trys.push([1,7,,8]),[4,t.createAnswer()];case 2:r=e.sent(),v.default.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),e.label=3;case 3:return e.trys.push([3,5,,6]),[4,t.setLocalDescription(r)];case 4:return e.sent(),v.default.log("Set localDescription:",r,"for:".concat(this.connection.peer)),n.socket.send({type:S.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,browser:p.browser},dst:this.connection.peer}),[3,6];case 5:return i=e.sent(),n.emitError(b.WebRTC,i),v.default.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return i=e.sent(),n.emitError(b.WebRTC,i),v.default.log("Failed to create answer, ",i),[3,8];case 8:return[2]}})})},k.prototype.handleSDP=function(s,o){return Cn(this,void 0,Promise,function(){var t,n,r,i;return wn(this,function(e){switch(e.label){case 0:o=new RTCSessionDescription(o),t=this.connection.peerConnection,n=this.connection.provider,v.default.log("Setting remote description",o),r=this,e.label=1;case 1:return e.trys.push([1,5,,6]),[4,t.setRemoteDescription(o)];case 2:return e.sent(),v.default.log("Set remoteDescription:".concat(s," for:").concat(this.connection.peer)),"OFFER"!==s?[3,4]:[4,r._makeAnswer()];case 3:e.sent(),e.label=4;case 4:return[3,6];case 5:return i=e.sent(),n.emitError(b.WebRTC,i),v.default.log("Failed to setRemoteDescription, ",i),[3,6];case 6:return[2]}})})},k.prototype.handleCandidate=function(a){return Cn(this,void 0,Promise,function(){var t,n,r,i,s,o;return wn(this,function(e){switch(e.label){case 0:v.default.log("handleCandidate:",a),t=a.candidate,n=a.sdpMLineIndex,r=a.sdpMid,i=this.connection.peerConnection,s=this.connection.provider,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,i.addIceCandidate(new RTCIceCandidate({sdpMid:r,sdpMLineIndex:n,candidate:t}))];case 2:return e.sent(),v.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return o=e.sent(),s.emitError(b.WebRTC,o),v.default.log("Failed to handleCandidate, ",o),[3,4];case 4:return[2]}})})},k.prototype._addTracksToConnection=function(t,n){if(v.default.log("add tracks from stream ".concat(t.id," to peer connection")),!n.addTrack)return v.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(function(e){n.addTrack(e,t)})},k.prototype._addStreamToMediaConnection=function(e,t){v.default.log("add stream ".concat(e.id," to media connection ").concat(t.connectionId)),t.addStream(e)},k);function k(e){this.connection=e}var T={};d(T,"BaseConnection",()=>Pn,e=>Pn=e),En=function(e,t){return(En=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}En(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(xn,Rn=u.EventEmitter),Object.defineProperty(xn.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0});var En,Rn,Pn=xn;function xn(e,t,n){var r=Rn.call(this)||this;return r.peer=e,r.provider=t,r.options=n,r._open=!1,r.metadata=n.metadata,r}On=function(e,t){return(On=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var On,In,Dn=function(){return(Dn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Nn=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}On(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(E,In=T.BaseConnection),Object.defineProperty(E.prototype,"type",{get:function(){return y.Media},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),E.prototype.addStream=function(e){v.default.log("Receiving stream",e),this._remoteStream=e,In.prototype.emit.call(this,"stream",e)},E.prototype.handleMessage=function(e){var t=e.type,n=e.payload;switch(e.type){case S.Answer:this._negotiator.handleSDP(t,n.sdp),this._open=!0;break;case S.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:v.default.warn("Unrecognized message type:".concat(t," from peer:").concat(this.peer))}},E.prototype.answer=function(e,t){var n,r;if(void 0===t&&(t={}),this._localStream)v.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection(Dn(Dn({},this.options._payload),{_stream:e}));t=this.provider._getMessages(this.connectionId);try{for(var i=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),s=i.next();!s.done;s=i.next()){var o=s.value;this.handleMessage(o)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}this._open=!0}},E.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,In.prototype.emit.call(this,"close"))},E.ID_PREFIX="mc_",E);function E(e,t,n){e=In.call(this,e,t,n)||this;return e._localStream=e.options._stream,e.connectionId=e.options.connectionId||E.ID_PREFIX+p.randomToken(),e._negotiator=new _n.Negotiator(e),e._localStream&&e._negotiator.startConnection({_stream:e._localStream,originator:!0}),e}var Ln={},An=(d(Ln,"DataConnection",()=>Vn,e=>Vn=e),{});d(An,"EncodingQueue",()=>Bn,e=>Bn=e),jn=function(e,t){return(jn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}jn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(Un,Mn=u.EventEmitter),Object.defineProperty(Un.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(Un.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(Un.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),Un.prototype.enque=function(e){this.queue.push(e),this.processing||this.doNextTask()},Un.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},Un.prototype.doNextTask=function(){0===this.size||this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift()))};var jn,Mn,Bn=Un;function Un(){var t=Mn.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(e){t._processing=!1,e.target&&t.emit("done",e.target.result),t.doNextTask()},t.fileReader.onerror=function(e){v.default.error("EncodingQueue error:",e),t._processing=!1,t.destroy(),t.emit("error",e)},t}Fn=function(e,t){return(Fn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Fn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(R,zn=T.BaseConnection),Object.defineProperty(R.prototype,"type",{get:function(){return y.Data},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),R.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},R.prototype._configureDataChannel=function(){var t=this;p.supports.binaryBlob&&!p.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){v.default.log("DC#".concat(t.connectionId," dc connection success")),t._open=!0,t.emit("open")},this.dataChannel.onmessage=function(e){v.default.log("DC#".concat(t.connectionId," dc onmessage:"),e.data),t._handleDataMessage(e)},this.dataChannel.onclose=function(){v.default.log("DC#".concat(t.connectionId," dc closed for:"),t.peer),t.close()}},R.prototype._handleDataMessage=function(e){var t=this,e=e.data,n=e.constructor,r=e;if(this.serialization===C.Binary||this.serialization===C.BinaryUTF8){if(n===Blob)return void p.blobToArrayBuffer(e,function(e){e=p.unpack(e);t.emit("data",e)});n===ArrayBuffer?r=p.unpack(e):n===String&&(n=p.binaryStringToArrayBuffer(e),r=p.unpack(n))}else this.serialization===C.JSON&&(r=this.parse(e));r.__peerData?this._handleChunk(r):zn.prototype.emit.call(this,"data",r)},R.prototype._handleChunk=function(e){var t=e.__peerData,n=this._chunkedData[t]||{data:[],count:0,total:e.total};n.data[e.n]=e.data,n.count++,(this._chunkedData[t]=n).total===n.count&&(delete this._chunkedData[t],e=new Blob(n.data),this._handleDataMessage({data:e}))},R.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,zn.prototype.emit.call(this,"close"))},R.prototype.send=function(e,t){var n;this.open?this.serialization===C.JSON?this._bufferedSend(this.stringify(e)):this.serialization===C.Binary||this.serialization===C.BinaryUTF8?(n=p.pack(e),!t&&n.size>p.chunkedMTU?this._sendChunks(n):p.supports.binaryBlob?this._bufferedSend(n):this._encodingQueue.enque(n)):this._bufferedSend(e):zn.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},R.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this._bufferSize=this._buffer.length)},R.prototype._trySend=function(e){var t=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>R.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){t._buffering=!1,t._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(e){return v.default.error("DC#:".concat(this.connectionId," Error when sending:"),e),this._buffering=!0,this.close(),!1}return!0},R.prototype._tryBuffer=function(){var e;this.open&&0!==this._buffer.length&&(e=this._buffer[0],this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer()))},R.prototype._sendChunks=function(e){var t,n,e=p.chunk(e);v.default.log("DC#".concat(this.connectionId," Try to send ").concat(e.length," chunks..."));try{for(var r=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i=r.next();!i.done;i=r.next()){var s=i.value;this.send(s,!0)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},R.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case S.Answer:this._negotiator.handleSDP(e.type,t.sdp);break;case S.Candidate:this._negotiator.handleCandidate(t.candidate);break;default:v.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},R.ID_PREFIX="dc_",R.MAX_BUFFERED_AMOUNT=8388608;var Fn,zn,Vn=R;function R(e,t,n){var r=zn.call(this,e,t,n)||this;return r.stringify=JSON.stringify,r.parse=JSON.parse,r._buffer=[],r._bufferSize=0,r._buffering=!1,r._chunkedData={},r._encodingQueue=new An.EncodingQueue,r.connectionId=r.options.connectionId||R.ID_PREFIX+p.randomToken(),r.label=r.options.label||r.connectionId,r.serialization=r.options.serialization||C.Binary,r.reliable=!!r.options.reliable,r._encodingQueue.on("done",function(e){r._bufferedSend(e)}),r._encodingQueue.on("error",function(){v.default.error("DC#".concat(r.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),r.close()}),r._negotiator=new _n.Negotiator(r),r._negotiator.startConnection(r.options._payload||{originator:!0}),r}function Hn(e,o,a,c){return new(a=a||Promise)(function(n,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,i)}s((c=c.apply(e,o||[])).next())})}function qn(r,i){var s,o,a,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(s)throw new TypeError("Generator is already executing.");for(;c;)try{if(s=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,o=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){c.label=t[1];break}if(6===t[0]&&c.label<a[1]){c.label=a[1],a=t;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(t);break}a[2]&&c.ops.pop(),c.trys.pop();continue}t=i.call(r,c)}catch(e){t=[6,e],o=0}finally{s=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}var Wn={},Gn=(d(Wn,"API",()=>Gn,e=>Gn=e),Jn.prototype._buildRequest=function(e){var t=this._options.secure?"https":"http",n=this._options,r=n.host,i=n.port,s=n.path,n=n.key,t=new URL("".concat(t,"://").concat(r,":").concat(i).concat(s).concat(n,"/").concat(e));return t.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),t.searchParams.set("version",gn.version),fetch(t.href,{referrerPolicy:this._options.referrerPolicy})},Jn.prototype.retrieveId=function(){return Hn(this,void 0,Promise,function(){var t,n;return qn(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(200!==(t=e.sent()).status)throw new Error("Error. Status:".concat(t.status));return[2,t.text()];case 2:throw t=e.sent(),v.default.error("Error retrieving ID",t),n="","/"===this._options.path&&this._options.host!==p.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 3:return[2]}})})},Jn.prototype.listAllPeers=function(){return Hn(this,void 0,Promise,function(){var t,n;return qn(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(200===(t=e.sent()).status)return[2,t.json()];if(401===t.status)throw n="",n=this._options.host===p.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n);throw new Error("Error. Status:".concat(t.status));case 2:throw n=e.sent(),v.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 3:return[2]}})})},Jn);function Jn(e){this._options=e}Yn=function(e,t){return(Yn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function Kn(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var Yn,$n,Xn=function(){return(Xn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Qn=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Yn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(P,$n=u.EventEmitter),Object.defineProperty(P.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"connections",{get:function(){var t,e,n=Object.create(null);try{for(var r=Kn(this._connections),i=r.next();!i.done;i=r.next()){var s=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}(i.value,2),o=s[0],a=s[1];n[o]=a}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),P.prototype._createServerConnection=function(){var t=this,e=new mn.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(w.Message,function(e){t._handleMessage(e)}),e.on(w.Error,function(e){t._abort(b.SocketError,e)}),e.on(w.Disconnected,function(){t.disconnected||(t.emitError(b.Network,"Lost connection to server."),t.disconnect())}),e.on(w.Close,function(){t.disconnected||t._abort(b.SocketClosed,"Underlying socket is already closed.")}),e},P.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},P.prototype._handleMessage=function(e){var t,n,r=e.type,i=e.payload,s=e.src;switch(r){case S.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case S.Error:this._abort(b.ServerError,i.msg);break;case S.IdTaken:this._abort(b.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case S.InvalidKey:this._abort(b.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case S.Leave:v.default.log("Received leave message from ".concat(s)),this._cleanupPeer(s),this._connections.delete(s);break;case S.Expire:this.emitError(b.PeerUnavailable,"Could not connect to peer ".concat(s));break;case S.Offer:var o=i.connectionId;if((p=this.getConnection(s,o))&&(p.close(),v.default.warn("Offer received for existing Connection ID:".concat(o))),i.type===y.Media){var a=new Sn.MediaConnection(s,this,{connectionId:o,_payload:i,metadata:i.metadata});this._addConnection(s,p=a),this.emit("call",a)}else{if(i.type!==y.Data)return void v.default.warn("Received malformed connection type:".concat(i.type));a=new Ln.DataConnection(s,this,{connectionId:o,_payload:i,metadata:i.metadata,label:i.label,serialization:i.serialization,reliable:i.reliable});this._addConnection(s,p=a),this.emit("connection",a)}a=this._getMessages(o);try{for(var c=Kn(a),l=c.next();!l.done;l=c.next()){var d=l.value;p.handleMessage(d)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}break;default:if(!i)return void v.default.warn("You received a malformed message from ".concat(s," of type ").concat(r));var p,o=i.connectionId;(p=this.getConnection(s,o))&&p.peerConnection?p.handleMessage(e):o?this._storeMessage(o,e):v.default.warn("You received an unrecognized message:",e)}},P.prototype._storeMessage=function(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)},P.prototype._getMessages=function(e){var t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]},P.prototype.connect=function(e,t){if(void 0===t&&(t={}),this.disconnected)return v.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(b.Disconnected,"Cannot connect to new Peer after disconnecting from server.");t=new Ln.DataConnection(e,this,t);return this._addConnection(e,t),t},P.prototype.call=function(e,t,n){if(void 0===n&&(n={}),this.disconnected)return v.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(b.Disconnected,"Cannot connect to new Peer after disconnecting from server.");{if(t)return n=new Sn.MediaConnection(e,this,Xn(Xn({},n),{_stream:t})),this._addConnection(e,n),n;v.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")}},P.prototype._addConnection=function(e,t){v.default.log("add connection ".concat(t.type,":").concat(t.connectionId," to peerId:").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)},P.prototype._removeConnection=function(e){var t,n=this._connections.get(e.peer);n&&-1!==(t=n.indexOf(e))&&n.splice(t,1),this._lostMessages.delete(e.connectionId)},P.prototype.getConnection=function(e,t){var n,r,e=this._connections.get(e);if(!e)return null;try{for(var i=Kn(e),s=i.next();!s.done;s=i.next()){var o=s.value;if(o.connectionId===t)return o}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return null},P.prototype._delayedAbort=function(e,t){var n=this;setTimeout(function(){n._abort(e,t)},0)},P.prototype._abort=function(e,t){v.default.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()},P.prototype.emitError=function(e,t){v.default.error("Error:",t),(t="string"==typeof t?new Error(t):t).type=e,this.emit("error",t)},P.prototype.destroy=function(){this.destroyed||(v.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},P.prototype._cleanup=function(){var t,e;try{for(var n=Kn(this._connections.keys()),r=n.next();!r.done;r=n.next()){var i=r.value;this._cleanupPeer(i),this._connections.delete(i)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.socket.removeAllListeners()},P.prototype._cleanupPeer=function(e){var t,n,e=this._connections.get(e);if(e)try{for(var r=Kn(e),i=r.next();!i.done;i=r.next())i.value.close()}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},P.prototype.disconnect=function(){var e;this.disconnected||(e=this.id,v.default.log("Disconnect peer with ID:".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e))},P.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)v.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"));v.default.error("In a hurry? We're still trying to make the initial connection!")}},P.prototype.listAllPeers=function(t){var n=this;void 0===t&&(t=function(e){}),this._api.listAllPeers().then(function(e){return t(e)}).catch(function(e){return n._abort(b.ServerError,e)})},P.DEFAULT_KEY="peerjs",P);function P(e,t){var n,r=$n.call(this)||this;return r._id=null,r._lastServerId=null,r._destroyed=!1,r._disconnected=!1,r._open=!1,r._connections=new Map,r._lostMessages=new Map,e&&e.constructor==Object?t=e:e&&(n=e.toString()),t=Xn({debug:0,host:p.CLOUD_HOST,port:p.CLOUD_PORT,path:"/",key:P.DEFAULT_KEY,token:p.randomToken(),config:p.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},t),r._options=t,"/"===r._options.host&&(r._options.host=window.location.hostname),r._options.path&&("/"!==r._options.path[0]&&(r._options.path="/"+r._options.path),"/"!==r._options.path[r._options.path.length-1]&&(r._options.path+="/")),void 0===r._options.secure&&r._options.host!==p.CLOUD_HOST?r._options.secure=p.isSecure():r._options.host==p.CLOUD_HOST&&(r._options.secure=!0),r._options.logFunction&&v.default.setLogFunction(r._options.logFunction),v.default.logLevel=r._options.debug||0,r._api=new Wn.API(t),r._socket=r._createServerConnection(),p.supports.audioVideo||p.supports.data?n&&!p.validateId(n)?r._delayedAbort(b.InvalidID,'ID "'.concat(n,'" is invalid')):n?r._initialize(n):r._api.retrieveId().then(function(e){return r._initialize(e)}).catch(function(e){return r._abort(b.ServerError,e)}):r._delayedAbort(b.BrowserIncompatible,"The current browser does not support WebRTC"),r}var Zn=t.Peer;class er{constructor(e){this.mediaRequested=!1,this.onVideoTrackCb=null,this.vdTrack=function(){const t=document.createElement("canvas"),n=(t.width=t.height=2,t.getContext("2d"));return null!==n&&void 0!==n&&n.fillRect(0,0,t.width,t.height),requestAnimationFrame(function e(){null!==n&&void 0!==n&&n.fillRect(0,0,t.width,t.height),requestAnimationFrame(e)}),t.captureStream(60).getTracks()[0]}(),this.stream=new MediaStream([e,this.vdTrack])}toggleVideo(){if(!this.mediaRequested)return navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{e=e.getVideoTracks()[0];if(e)return this.stream.addTrack(e),this.stream.removeTrack(this.vdTrack),this.mediaRequested=!0,this.onVideoTrackCb&&this.onVideoTrackCb(e),!0;throw new Error("No video track provided")}).catch(e=>(console.error(e),!1));let t=!0;return this.stream.getVideoTracks().forEach(e=>{e.enabled=t=t&&!e.enabled}),Promise.resolve(t)}toggleAudio(){let t=!0;return this.stream.getAudioTracks().forEach(e=>{e.enabled=t=t&&!e.enabled}),t}onVideoTrack(e){this.onVideoTrackCb=e}stop(){this.stream.getTracks().forEach(e=>e.stop())}}class tr{constructor(e){this.agentName=e,this.position=[0,0],this.pScrEl=document.scrollingElement||document.documentElement,this.lastScrEl=null,this.resetLastScrEl=()=>{this.lastScrEl=null},this.handleWScroll=e=>{e.target!==this.lastScrEl&&"window"!==this.lastScrEl&&this.resetLastScrEl()},this.mouse=document.createElement("div");const t=document.createElement("div");this.mouse.innerHTML='<svg version="1.1" width="20" height="20" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" xml:space="" viewBox="8.2 4.9 11.6 18.2"><polygon fill="#FFFFFF" points="8.2,20.9 8.2,4.9 19.8,16.5 13,16.5 12.6,16.6 "></polygon><polygon fill="#FFFFFF" points="17.3,21.6 13.7,23.1 9,12 12.7,10.5 "></polygon><rect x="12.5" y="13.6" transform="matrix(0.9221 -0.3871 0.3871 0.9221 -5.7605 6.5909)" width="2" height="8"></rect><polygon points="9.2,7.3 9.2,18.5 12.2,15.6 12.6,15.5 17.4,15.5 "></polygon></svg>',this.mouse.setAttribute("data-openreplay-hidden",""),Object.assign(t.style,{position:"absolute",padding:"4px 5px",borderRadius:"4px",backgroundColor:"#394EFF",color:"white",bottom:"-20px",left:"65%",fontSize:"12px",whiteSpace:"nowrap"});e=this.agentName?10<this.agentName.length?this.agentName.slice(0,9)+"...":this.agentName:"Agent";t.innerHTML=`<span>${e}</span>`,this.mouse.appendChild(t),Object.assign(this.mouse.style,{position:"absolute",zIndex:"999998",pointerEvents:"none"})}mount(){document.body.appendChild(this.mouse),window.addEventListener("scroll",this.handleWScroll),window.addEventListener("resize",this.resetLastScrEl)}move(e){this.position[0]===e[0]&&this.position[1]===e[1]||this.resetLastScrEl(),this.position=e,Object.assign(this.mouse.style,{left:`${e[0]||0}px`,top:`${e[1]||0}px`})}getPosition(){return this.position}click(e){const t=document.elementFromPoint(e[0],e[1]);return t instanceof HTMLElement?(t.click(),t.focus(),t):null}scroll(e){var[t,n]=this.position,[r,i]=e;let s=this.lastScrEl;if(s instanceof Element)return s.scrollLeft+=r,void(s.scrollTop+=i);if("window"===s)window.scroll(this.pScrEl.scrollLeft+r,this.pScrEl.scrollTop+i);else{for(s=document.elementFromPoint(t-this.pScrEl.scrollLeft,n-this.pScrEl.scrollTop);s;){if(s.scrollHeight>s.clientHeight||s.scrollWidth>s.clientWidth){const c=getComputedStyle(s);if(0<=c.overflow.indexOf("scroll")||0<=c.overflow.indexOf("auto")){var o=s.scrollLeft,a=s.scrollTop;if(s.scrollLeft+=r,s.scrollTop+=i,o!==s.scrollLeft||a!==s.scrollTop)return void(this.lastScrEl=s)}}s=s.parentElement}window.scroll(this.pScrEl.scrollLeft+r,this.pScrEl.scrollTop+i),this.lastScrEl="window"}}remove(){this.mouse.parentElement&&document.body.removeChild(this.mouse),window.removeEventListener("scroll",this.handleWScroll),window.removeEventListener("resize",this.resetLastScrEl)}}function nr(e,t){if(e instanceof HTMLButtonElement)return e;const n=document.createElement("button");return Object.assign(n.style,{padding:"10px 14px",fontSize:"14px",borderRadius:"3px",border:"none",cursor:"pointer",display:"flex",alignItems:"center",textTransform:"uppercase",marginRight:"10px"},t),"string"==typeof e?n.innerHTML=e:(n.innerHTML=e.innerHTML,Object.assign(n.style,e.style)),n}class rr{constructor(e){this.resolve=()=>{},this.reject=()=>{};const t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("p"),i=(t.id="openreplay-confirm-window-wrapper",n.id="openreplay-confirm-window-popup",r.id="openreplay-confirm-window-p",r.innerText=e.text,document.createElement("div")),s=(i.id="openreplay-confirm-window-buttons",nr(e.confirmBtn,{background:"rgba(0, 167, 47, 1)",color:"white"})),o=(s.id="openreplay-confirm-window-confirm-btn",nr(e.declineBtn,{background:"#FFE9E9",color:"#CC0000"}));o.id="openreplay-confirm-window-decline-btn",i.appendChild(s),i.appendChild(o),n.appendChild(r),n.appendChild(i),Object.assign(i.style,{marginTop:"10px",display:"flex",alignItems:"center",backgroundColor:"white",padding:"10px",boxShadow:"0px 0px 3.99778px 1.99889px rgba(0, 0, 0, 0.1)",borderRadius:"6px"}),Object.assign(n.style,{font:"14px 'Roboto', sans-serif",position:"relative",pointerEvents:"auto",margin:"4em auto",width:"90%",maxWidth:"fit-content",padding:"20px",background:"#F3F3F3",color:"black",borderRadius:"3px",boxShadow:"0px 0px 3.99778px 1.99889px rgba(0, 0, 0, 0.1)"},e.style),Object.assign(t.style,{position:"fixed",left:0,top:0,height:"100%",width:"100%",pointerEvents:"none",zIndex:2147483646}),t.appendChild(n),t.setAttribute("data-openreplay-hidden",""),this.wrapper=t,s.onclick=()=>{this.resolve(!0)},o.onclick=()=>{this.resolve(!1)}}mount(){return document.body.appendChild(this.wrapper),new Promise((e,t)=>{this.resolve=e,this.reject=t})}_remove(){this.wrapper.parentElement&&this.wrapper.parentElement.removeChild(this.wrapper)}remove(){this._remove(),this.reject("no answer")}}const ir=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
<path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>
</svg>`;var sr,T=ir.replace('fill="#ef5261"','fill="green"');const or="Reject",ar=T+" &#xa0 Answer";function cr(e,t,n,r){var i="string"==typeof e;return Object.assign({text:i?e:r,confirmBtn:t,declineBtn:n},i?void 0:e)}(u=sr=sr||{})[u.Disabled=0]="Disabled",u[u.Requesting=1]="Requesting",u[u.Enabled=2]="Enabled";let lr=function(e){this.value=e};var x,O,dr,D,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value");t&&t.set&&(lr=t.set);class pr{constructor(e,t,n){this.options=e,this.onGrand=t,this.onRelease=n,this.status=sr.Disabled,this.agentID=null,this.confirm=null,this.requestControl=t=>{null!==this.agentID?this.releaseControl():(setTimeout(()=>{this.status===sr.Requesting&&this.releaseControl()},3e4),this.agentID=t,this.status=sr.Requesting,this.confirm=new rr(cr(this.options.controlConfirm,"Grant Remote Control",or,"Agent requested remote control. Allow?")),this.confirm.mount().then(e=>{e?this.grantControl(t):(null!=(e=this.confirm)&&e.remove(),this.releaseControl())}).then(()=>{var e;null!=(e=this.confirm)&&e.remove()}).catch(e=>{var t;null!=(t=this.confirm)&&t.remove(),console.error(e)}))},this.releaseControl=()=>{this.confirm&&(this.confirm.remove(),this.confirm=null),this.resetMouse(),this.status=sr.Disabled,sessionStorage.removeItem(this.options.session_control_peer_key),this.onRelease(this.agentID),this.agentID=null},this.grantControl=e=>{this.agentID=e,this.status=sr.Enabled,sessionStorage.setItem(this.options.session_control_peer_key,e);e=this.onGrand(e);this.mouse&&this.resetMouse(),this.mouse=new tr(e),this.mouse.mount()},this.resetMouse=()=>{var e;null!=(e=this.mouse)&&e.remove(),this.mouse=null},this.scroll=(e,t)=>{e===this.agentID&&null!=(e=this.mouse)&&e.scroll(t)},this.move=(e,t)=>{e===this.agentID&&null!=(e=this.mouse)&&e.move(t)},this.focused=null,this.click=(e,t)=>{e===this.agentID&&this.mouse&&(this.focused=this.mouse.click(t))},this.focus=(e,t)=>{this.focused=t},this.input=(e,t)=>{e===this.agentID&&this.mouse&&this.focused&&(this.focused instanceof HTMLTextAreaElement||this.focused instanceof HTMLInputElement?(lr.call(this.focused,t),e=new Event("input",{bubbles:!0}),this.focused.dispatchEvent(e)):this.focused.isContentEditable&&(this.focused.innerText=t))}}reconnect(e){var t=sessionStorage.getItem(this.options.session_control_peer_key);null!==t&&-1!==e.indexOf(t)?this.grantControl(t):sessionStorage.removeItem(this.options.session_control_peer_key)}}function hr(t,e,n){e.addEventListener("pointerdown",function(e){i=e.clientX,s=e.clientY,r=t.getBoundingClientRect(),n.addEventListener("pointermove",l,{passive:!0}),n.addEventListener("pointerup",p,{passive:!0}),n.addEventListener("pointercancel",p,{passive:!0})},{passive:!0});let r,i,s,o,a=0,c=0;function l(e){o||(a+=e.clientX-i,c+=e.clientY-s,a=Math.min(Math.max(a,-r.left),window.innerWidth-r.right),c=Math.min(Math.max(c,-r.top),window.innerHeight-r.bottom),o=requestAnimationFrame(d))}function d(){t.style.transform="translate3d("+a+"px,"+c+"px, 0px)",o=null}function p(){n.removeEventListener("pointermove",l),n.removeEventListener("pointerup",p),n.removeEventListener("pointercancel",p),o&&(cancelAnimationFrame(o),o=null),t.style.left=r.left+a+"px",t.style.top=r.top+c+"px",t.style.transform="translate3d(0px,0px,0px)",a=c=0}}const ur="__openreplay_assist_call_start_ts";class fr{constructor(e,t){this.logError=e,this.callUITemplate=t,this.vRemote=null,this.vLocal=null,this.audioBtn=null,this.videoBtn=null,this.endCallBtn=null,this.agentNameElem=null,this.videoContainer=null,this.vPlaceholder=null,this.remoteControlContainer=null,this.remoteControlEndBtn=null,this.controlsContainer=null,this.remoteVideoOn=!1,this.localVideoOn=!1,this.audioContainer=null,this.localStreams=[];const i=this.iframe=document.createElement("iframe"),s=(Object.assign(i.style,{position:"fixed",zIndex:2147483646,border:"none",bottom:"50px",right:"10px",height:"200px",width:"200px"}),i.setAttribute("data-openreplay-obscured",""),i.setAttribute("data-openreplay-hidden",""),i.setAttribute("data-openreplay-ignore",""),document.body.appendChild(i),i.contentDocument);if(s){const o="https://static.openreplay.com/tracker-assist/4.0.0";this.load=fetch(this.callUITemplate||o+"/index.html").then(e=>e.text()).then(e=>{i.onload=()=>{const e=s.getElementById("or-assist");null!==e&&void 0!==e&&e.classList.remove("status-connecting"),this.adjustIframeSize(),i.onload=null},e=e.replace(/href="css/g,`href="${o}/css`),s.open(),s.write(e),s.close(),this.vLocal=s.getElementById("video-local"),this.vRemote=s.getElementById("video-remote"),this.videoContainer=s.getElementById("video-container"),this.audioBtn=s.getElementById("audio-btn"),this.audioBtn&&(this.audioBtn.onclick=()=>this.toggleAudio()),this.videoBtn=s.getElementById("video-btn"),this.videoBtn&&(this.videoBtn.onclick=()=>this.toggleVideo()),this.endCallBtn=s.getElementById("end-call-btn"),this.agentNameElem=s.getElementById("agent-name"),this.vPlaceholder=s.querySelector("#remote-stream p"),this.remoteControlContainer=s.getElementById("remote-control-row"),this.remoteControlEndBtn=s.getElementById("end-control-btn"),this.controlsContainer=s.getElementById("controls"),this.controlsContainer&&(this.controlsContainer.style.display="none");const n=s.getElementById("duration");if(n){const r=Number(sessionStorage.getItem(ur))||Date.now();sessionStorage.setItem(ur,r.toString()),this.tsInterval=setInterval(()=>{var e=~~((Date.now()-r)/1e3),t=~~(e/60),e=e-60*t;n.innerText=(0<t?t+"m":"")+(e<10?0:"")+e+"s"},500)}e=s.querySelector(".drag-area");e&&hr(i,e,s.documentElement)})}else console.error("OpenReplay: CallWindow iframe document is not reachable.")}adjustIframeSize(){var e=this.iframe.contentDocument;e&&(this.iframe.style.height=e.body.scrollHeight+"px",this.iframe.style.width=e.body.scrollWidth+"px")}addRemoteStream(n,r){this.load.then(()=>{if(this.vRemote&&!this.vRemote.srcObject){this.vRemote.srcObject=n,this.remoteVideo=n.getVideoTracks()[0],this.remoteVideoId=r,this.vPlaceholder&&(this.vPlaceholder.innerText="Video has been paused. Click anywhere to resume."),this.checkRemoteVideoInterval&&clearInterval(this.checkRemoteVideoInterval);let t=!1;this.checkRemoteVideoInterval=setInterval(()=>{var e=null==(e=this.remoteVideo)?void 0:e.getSettings(),e=!(!this.remoteVideo.enabled||!!e&&(2===e.width||0===e.frameRate));t!==e&&this.toggleRemoteVideoUI(t=e)},1e3)}this.audioContainer||(this.audioContainer=document.createElement("div"),document.body.appendChild(this.audioContainer));const e=document.createElement("audio");e.autoplay=!0,e.style.display="none",e.srcObject=n,this.audioContainer.appendChild(e)}).catch(e=>this.logError(e))}toggleRemoteVideoUI(e){this.load.then(()=>{this.videoContainer&&((this.remoteVideoOn=e)?this.videoContainer.classList.add("remote"):this.videoContainer.classList.remove("remote"),this.adjustIframeSize())}).catch(e=>this.logError(e))}setLocalStreams(e){this.localStreams=e}playRemote(){this.vRemote&&this.vRemote.play()}setAssistentName(n){this.load.then(()=>{if(this.agentNameElem){const t=Array.from(n.values()).join(", ");var e=20<t.length?t.substring(0,20)+"...":t;this.agentNameElem.innerText=e}}).catch(e=>this.logError(e))}toggleAudioUI(e){this.audioBtn&&(e?this.audioBtn.classList.remove("muted"):this.audioBtn.classList.add("muted"))}toggleAudio(){let t=!1;this.localStreams.forEach(e=>{t=e.toggleAudio()||!1}),this.toggleAudioUI(t)}toggleVideoUI(e){this.videoBtn&&this.videoContainer&&((this.localVideoOn=e)?(this.videoContainer.classList.add("local"),this.videoBtn.classList.remove("off")):(this.videoContainer.classList.remove("local"),this.videoBtn.classList.add("off")),this.adjustIframeSize())}toggleVideo(){this.localStreams.forEach(n=>{n.toggleVideo().then(e=>{var t;null!=(t=this.onToggleVideo)&&t.call(this,{streamId:n.stream.id,enabled:e}),this.toggleVideoUI(e),this.load.then(()=>{this.vLocal&&n&&!this.vLocal.srcObject&&(this.vLocal.srcObject=n.stream)}).catch(e=>this.logError(e))}).catch(e=>this.logError(e))})}showRemoteControl(e){this.load.then(()=>{this.remoteControlContainer&&(this.remoteControlContainer.style.display="flex"),this.remoteControlEndBtn&&(this.remoteControlEndBtn.onclick=e),this.adjustIframeSize()}).catch(e=>this.logError(e))}showControls(e){this.load.then(()=>{this.controlsContainer&&(this.controlsContainer.style.display="unset"),this.endCallBtn&&(this.endCallBtn.onclick=e),this.adjustIframeSize()}).catch(e=>this.logError(e))}hideControls(){this.controlsContainer&&(this.controlsContainer.style.display="none"),this.adjustIframeSize()}hideRemoteControl(){this.remoteControlContainer&&(this.remoteControlContainer.style.display="none"),this.adjustIframeSize()}setVideoToggleCallback(e){this.onToggleVideo=e}remove(){clearInterval(this.tsInterval),clearInterval(this.checkRemoteVideoInterval),this.audioContainer&&this.audioContainer.parentElement&&(this.audioContainer.parentElement.removeChild(this.audioContainer),this.audioContainer=null),this.iframe.parentElement&&this.iframe.parentElement.removeChild(this.iframe),sessionStorage.removeItem(ur),this.localStreams=[]}toggleVideoStream({streamId:e,enabled:t}){this.remoteVideoId===e&&(this.remoteVideo.enabled=t,this.toggleRemoteVideoUI(t))}}class mr{constructor(){this.ctx=null,this.painting=!1,this.resizeCanvas=()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight},this.lastPosition=[0,0],this.start=e=>{this.painting=!0,this.clrTmID&&clearTimeout(this.clrTmID),this.lastPosition=e},this.stop=()=>{this.painting&&(this.painting=!1,this.fadeOut())},this.move=e=>{this.ctx&&this.painting&&(this.ctx.globalAlpha=1,this.ctx.beginPath(),this.ctx.moveTo(this.lastPosition[0],this.lastPosition[1]),this.ctx.lineTo(e[0],e[1]),this.ctx.lineWidth=8,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.strokeStyle="red",this.ctx.stroke(),this.lastPosition=e)},this.clrTmID=null,this.canvas=document.createElement("canvas"),Object.assign(this.canvas.style,{position:"fixed",left:0,top:0,pointerEvents:"none",zIndex:2147483645})}fadeOut(){let e;const t=()=>{this.ctx&&!this.painting&&(this.ctx.globalCompositeOperation="destination-out",this.ctx.fillStyle="rgba(255, 255, 255, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.globalCompositeOperation="source-over",e=setTimeout(t,100))};this.clrTmID=setTimeout(()=>{clearTimeout(e),this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},4e3),t()}mount(){document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),window.addEventListener("resize",this.resizeCanvas),this.resizeCanvas()}remove(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),window.removeEventListener("resize",this.resizeCanvas)}}(T=x=x||{})[T.Requesting=0]="Requesting",T[T.True=1]="True",T[T.False=2]="False";class gr{constructor(e,t,n=!1){this.app=e,this.noSecureMode=n,this.version="4.1.3",this.socket=null,this.peer=null,this.assistDemandedRestart=!1,this.callingState=x.False,this.remoteControl=null,this.agents={},this.setCallingState=e=>{this.callingState=e},this.options=Object.assign({session_calling_peer_key:"__openreplay_calling_peer",session_control_peer_key:"__openreplay_control_peer",config:null,serverURL:null,onCallStart:()=>{},onAgentConnect:()=>{},onRemoteControlStart:()=>{},callConfirm:{},controlConfirm:{}},t),void 0!==document.hidden&&e.attachEventListener(document,"visibilitychange",()=>this.emit("UPDATE_SESSION",{active:!document.hidden}),!1,!1);const r=document.querySelector("title"),i=r&&new MutationObserver(()=>{this.emit("UPDATE_SESSION",{pageTitle:document.title})});e.attachStartCallback(()=>{this.assistDemandedRestart||(this.onStart(),i&&i.observe(r,{subtree:!0,characterData:!0,childList:!0}))}),e.attachStopCallback(()=>{this.assistDemandedRestart||(this.clean(),i&&i.disconnect())}),e.attachCommitCallback(e=>{!this.agentsConnected||2===e.length&&0===e[0]._id&&49===e[1]._id||this.emit("messages",e)}),e.session.attachUpdateCallback(e=>this.emit("UPDATE_SESSION",e))}emit(e,...t){this.socket&&this.socket.emit(e,...t)}get agentsConnected(){return 0<Object.keys(this.agents).length}getHost(){return this.options.serverURL?new URL(this.options.serverURL).host:this.app.getHost()}getBasePrefixUrl(){return this.options.serverURL?new URL(this.options.serverURL).pathname:""}onStart(){const r=this.app;var e=r.getSessionID();if(!e)return r.debug.error("No session ID");e=r.getProjectKey()+"-"+e;const t=this.socket=ze(this.getHost(),{path:this.getBasePrefixUrl()+"/ws-assist/socket",query:{peerId:e,identity:"session",sessionInfo:JSON.stringify(Object.assign({pageTitle:document.title,active:!0},this.app.getSessionInfo()))},transports:["websocket"]});t.onAny((...e)=>r.debug.log("Socket:",...e)),this.remoteControl=new pr(this.options,e=>(d=d||new fr(r.debug.error,this.options.callUITemplate),this.remoteControl&&null!==d&&void 0!==d&&d.showRemoteControl(this.remoteControl.releaseControl),this.agents[e].onControlReleased=this.options.onRemoteControlStart(this.agents[e].agentInfo),this.emit("control_granted",e),(i=new mr).mount(),n.get(e)),e=>{if(e){const t=this.agents[e].onControlReleased;delete this.agents[e].onControlReleased,"function"==typeof t&&t(),this.emit("control_rejected",e)}null!=i&&(i.remove(),i=null),null!==d&&void 0!==d&&d.hideRemoteControl(),this.callingState!==x.True&&(null!==d&&void 0!==d&&d.remove(),d=null)}),t.on("request_control",this.remoteControl.requestControl),t.on("release_control",this.remoteControl.releaseControl),t.on("scroll",this.remoteControl.scroll),t.on("click",this.remoteControl.click),t.on("move",this.remoteControl.move),t.on("focus",(e,t)=>{t=r.nodes.getNode(t);t instanceof HTMLElement&&this.remoteControl&&this.remoteControl.focus(e,t)}),t.on("input",this.remoteControl.input);let i=null;t.on("moveAnnotation",(e,t)=>i&&i.move(t)),t.on("startAnnotation",(e,t)=>i&&i.start(t)),t.on("stopAnnotation",()=>i&&i.stop()),t.on("NEW_AGENT",(e,t)=>{var n;this.agents[e]={onDisconnect:null==(n=(e=this.options).onAgentConnect)?void 0:n.call(e,t),agentInfo:t},this.assistDemandedRestart=!0,this.app.stop(),this.app.start().then(()=>{this.assistDemandedRestart=!1}).catch(e=>r.debug.error(e))}),t.on("AGENTS_CONNECTED",e=>{var t;e.forEach(e=>{var t,n=null==(n=this.agents[e])?void 0:n.agentInfo;this.agents[e]={agentInfo:n,onDisconnect:null==(t=(e=this.options).onAgentConnect)?void 0:t.call(e,n)}}),this.assistDemandedRestart=!0,this.app.stop(),this.app.start().then(()=>{this.assistDemandedRestart=!1}).catch(e=>r.debug.error(e)),null!=(t=this.remoteControl)&&t.reconnect(e)}),t.on("AGENT_DISCONNECTED",e=>{var t,n;null!=(t=this.remoteControl)&&t.releaseControl(),null!=(n=null==(t=this.agents[e])?void 0:t.onDisconnect)&&n.call(t),delete this.agents[e],a(e)}),t.on("NO_AGENT",()=>{Object.values(this.agents).forEach(e=>{var t;return null==(t=e.onDisconnect)?void 0:t.call(e)}),this.agents={}}),t.on("call_end",e=>{n.has(e)?a(e):r.debug.warn("Received call_end from unknown agent",e)}),t.on("_agent_name",(e,t)=>{n.set(e,t),p()}),t.on("videofeed",(e,t)=>{null!==d&&void 0!==d&&d.toggleVideoStream(t)});const n=new Map,s={},o={};function a(e){n.delete(e),(0===n.size?v:p)()}const c={host:this.getHost(),path:this.getBasePrefixUrl()+"/assist",port:"http:"===location.protocol&&this.noSecureMode?80:443},l=(this.options.config&&(c.config=this.options.config),this.peer=new Zn(e,c));l.on("error",e=>r.debug.warn("Peer error: ",e.type,e)),l.on("disconnected",()=>l.reconnect());let d=null;function p(){null!==d&&void 0!==d&&d.setAssistentName(n)}let h=null,u=null;const f=()=>{h&&(h.remove(),h=null,u=null)},m=()=>{return u||(h=new rr(cr(this.options.callConfirm||{text:this.options.confirmText,style:this.options.confirmStyle},ar,or,"You have an incoming call. Do you want to answer?")),u=h.mount().then(e=>(f(),e)))};let g=null;const v=()=>{var e;Object.values(s).forEach(e=>e.close()),Object.keys(s).forEach(e=>{delete s[e]}),Object.values(o).forEach(e=>{e.stop()}),Object.keys(o).forEach(e=>{delete o[e]}),f(),(null==(e=this.remoteControl)?void 0:e.status)===sr.Disabled?(null!==d&&void 0!==d&&d.remove(),null!==i&&void 0!==i&&i.remove(),d=null,i=null):null!==d&&void 0!==d&&d.hideControls(),this.emit("UPDATE_SESSION",{agentIds:[],isCallActive:!1}),this.setCallingState(x.False),sessionStorage.removeItem(this.options.session_calling_peer_key),null!==g&&void 0!==g&&g()},y=()=>{this.emit("call_end"),v()},b=({enabled:e})=>{var t;return this.emit("videofeed",{streamId:null==(t=this.peer)?void 0:t.id,enabled:e})};l.on("call",n=>{r.debug.log("Incoming call: ",n);let e;const t=JSON.parse(sessionStorage.getItem(this.options.session_calling_peer_key)||"[]");t.includes(n.peer)||this.callingState===x.True?e=Promise.resolve(!0):(this.setCallingState(x.Requesting),e=m(),this.playNotificationSound(),setTimeout(()=>{this.callingState===x.Requesting&&y()},3e4)),e.then(async e=>{if(e){try{o[n.peer]||(r.debug.log("starting new stream for",n.peer),o[n.peer]=await navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{e=e.getAudioTracks()[0];if(e)return new er(e);throw new Error("No audio tracks provided")})),s[n.peer]=n}catch(e){return r.debug.error("Audio mediadevice request error:",e),void y()}d||(d=new fr(r.debug.error,this.options.callUITemplate)).setVideoToggleCallback(b),d.showControls(y),i||(i=new mr).mount(),d.setLocalStreams(Object.values(o)),n.on("error",e=>{r.debug.warn("Call error:",e),y()}),n.on("stream",e=>{null!==d&&void 0!==d&&d.addRemoteStream(e,n.peer);const t=()=>{null!==d&&void 0!==d&&d.playRemote(),document.removeEventListener("click",t)};document.addEventListener("click",t)}),o[n.peer].onVideoTrack(e=>{const t=n.peerConnection.getSenders().find(e=>{return"video"===(null==(e=e.track)?void 0:e.kind)});t?(r.debug.log("sender found:",t),t.replaceTrack(e)):r.debug.warn("No video sender found")}),n.answer(o[n.peer].stream),this.setCallingState(x.True),g=g||(null==(t=(e=this.options).onCallStart)?void 0:t.call(e));var t=Object.keys(s);sessionStorage.setItem(this.options.session_calling_peer_key,JSON.stringify(t)),this.emit("UPDATE_SESSION",{agentIds:t,isCallActive:!0})}else y()}).catch(e=>{r.debug.log(e)})})}playNotificationSound(){"Audio"in window&&new Audio("https://static.openreplay.com/tracker-assist/notification.mp3").play().catch(e=>{this.app.debug.warn(e)})}clean(){var e;null!=(e=this.remoteControl)&&e.releaseControl(),this.peer&&(this.peer.destroy(),this.app.debug.log("Peer destroyed")),this.socket&&(this.socket.disconnect(),this.app.debug.log("Socket disconnected"))}}function vr(e){return(vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yr(e,t,n){return[12,e,t,n]}function br(e,t){return[13,e,t]}function Cr(e,t){return[19,e,t]}function wr(e,t){return[30,e,t]}function Sr(e,t,n,r,i,s,o,a){return[53,e,t,n,r,i,s,o,a]}function _r(e,t,n,r){return[57,e,t,n,r]}function kr(e){return[58,e]}function Tr(e,t,n,r){return[60,e,t,n,r]}function Er(e,t){return[70,e,t]}function Rr(e,t,n){return[71,e,t,n]}function Pr(e,t,n,r){return[73,e,t,n,r]}function xr(e,t){return[75,e,t]}function Or(e,t){return[76,e,t]}function Ir(e,t,n,r){return[78,e,t,n,r]}const Dr={htmlmasked:"hidden",masked:"obscured"},N=!("undefined"==typeof window),Nr=N&&navigator.userAgent.match(/firefox|fxios/i);let Lr=N?Date.now()-performance.now():0;const Ar=N&&performance.now?()=>Math.round(performance.now()+Lr):()=>Date.now(),jr="repeat"in String.prototype?e=>"*".repeat(e.length):e=>e.replace(/./g,"*");function Mr(e){return e.trim().replace(/\s+/g," ")}function Br(e){return e.startsWith("https://")||e.startsWith("http://")}const Ur="https://docs.openreplay.com",Fr={};function zr(e,t,n="/"){Fr[e]||(console.warn(`OpenReplay: ${e} is deprecated. ${t?`Please, use ${t} instead.`:""} Visit ${Ur}${n} for more information.`),Fr[e]=!0)}function Vr(e){let t=e.getAttribute("data-openreplay-label");return null!==t||null!==(t=e.getAttribute("data-asayer-label"))&&zr('"data-asayer-label" attribute','"data-openreplay-label" attribute',"/"),t}function Hr(e,t){var n="data-openreplay-"+t;return e.hasAttribute(n)&&(Dr[t]&&zr(`"${n}" attribute`,`"${Dr[t]}" attribute`,"/installation/sanitize-data"),1)}class qr{constructor(e){this.node_id=e,this.nodes=[],this.nodeCallbacks=[],this.elementListeners=new Map}attachNodeCallback(e){this.nodeCallbacks.push(e)}attachNodeListener(t,n,r,i=!0){var s=this.getID(t);if(void 0!==s){t.addEventListener(n,r,i);let e=this.elementListeners.get(s);void 0===e&&(e=[],this.elementListeners.set(s,e)),e.push([n,r,i])}}registerNode(e){let t=e[this.node_id];var n=void 0===t;return n&&(t=this.nodes.length,(this.nodes[t]=e)[this.node_id]=t),[t,n]}unregisterNode(t){var e=t[this.node_id];if(void 0!==e){delete t[this.node_id],delete this.nodes[e];const n=this.elementListeners.get(e);void 0!==n&&(this.elementListeners.delete(e),n.forEach(e=>t.removeEventListener(e[0],e[1],e[2])))}return e}cleanTree(){for(let e=0;e<this.nodes.length;e++){var t=this.nodes[e];t&&!document.contains(t)&&this.unregisterNode(t)}}callNodeCallbacks(t,n){this.nodeCallbacks.forEach(e=>e(t,n))}getID(e){return e[this.node_id]}getNode(e){return this.nodes[e]}clear(){for(let e=0;e<this.nodes.length;e++){var t=this.nodes[e];void 0!==t&&this.unregisterNode(t)}this.nodes.length=0}}function Wr(e){return e&&null!=e.nodeType}function Gr(e){return"http://www.w3.org/2000/svg"===e.namespaceURI}function L(e){return e.nodeType===Node.ELEMENT_NODE}function Jr(e){return e.nodeType===Node.TEXT_NODE}function Kr(e){return e.nodeType===Node.DOCUMENT_NODE}function Yr(e){return e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function A(e,t){return e.nodeName===t}function $r(e){if(!Jr(e)){if(!L(e))return 1;var t=e.tagName.toUpperCase();if("LINK"!==t)return"SCRIPT"===t||"NOSCRIPT"===t||"META"===t||"TITLE"===t||"BASE"===t;{const n=e.getAttribute("rel");t=e.getAttribute("as");return!(null!==n&&void 0!==n&&n.includes("stylesheet")||"style"===t||"font"===t)}}}function Xr(e){return Yr(e)||!$r(e)}(u=O=O||{})[u.New=0]="New",u[u.Removed=1]="Removed",u[u.Changed=2]="Changed";class Qr{constructor(e,t=!1){this.app=e,this.isTopContext=t,this.commited=[],this.recents=new Map,this.indexes=[],this.attributesMap=new Map,this.textSet=new Set,this.observer=new MutationObserver(this.app.safe(e=>{for(const i of e){var t=i.target,n=i.type;if(Xr(t))if("childList"===n){for(let e=0;e<i.removedNodes.length;e++)Xr(i.removedNodes[e])&&this.bindNode(i.removedNodes[e]);for(let e=0;e<i.addedNodes.length;e++)this.bindTree(i.addedNodes[e])}else{t=this.app.nodes.getID(t);if(void 0!==t)if(this.recents.has(t)||this.recents.set(t,O.Changed),"attributes"===n){var r=i.attributeName;if(null===r)continue;let e=this.attributesMap.get(t);void 0===e&&this.attributesMap.set(t,e=new Set),e.add(r)}else"characterData"===n&&this.textSet.add(t)}}this.commitNodes()}))}clear(){this.commited.length=0,this.recents.clear(),this.indexes.length=1,this.attributesMap.clear(),this.textSet.clear()}sendNodeAttribute(e,t,n,r){if(Gr(t))return"xlink:"===n.substr(0,6)&&(n=n.substr(6)),void(null===r?this.app.send(br(e,n)):"href"===n?(1e5<r.length&&(r=""),this.app.send(Tr(e,n,r,this.app.getBaseHref()))):this.app.send(yr(e,n,r)));"src"===n||"srcset"===n||"integrity"===n||"crossorigin"===n||"autocomplete"===n||"on"===n.substr(0,2)||"value"===n&&A(t,"INPUT")&&"button"!==t.type&&"reset"!==t.type&&"submit"!==t.type||(null===r?this.app.send(br(e,n)):"style"===n||"href"===n&&A(t,"LINK")?this.app.send(Tr(e,n,r,this.app.getBaseHref())):(("href"===n||1e5<r.length)&&(r=""),this.app.send(yr(e,n,r))))}sendNodeData(e,t,n){A(t,"STYLE")||A(t,"style")?this.app.send([61,e,n,this.app.getBaseHref()]):(n=this.app.sanitizer.sanitize(e,n),this.app.send([14,e,n]))}bindNode(e){var[e,t]=this.app.nodes.registerNode(e);t?this.recents.set(e,O.New):this.recents.get(e)!==O.New&&this.recents.set(e,O.Removed)}bindTree(e){if(Xr(e)){this.bindNode(e);const t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:e=>$r(e)||void 0!==this.app.nodes.getID(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1);for(;t.nextNode();)this.bindNode(t.currentNode)}}unbindTree(e){var t=this.app.nodes.unregisterNode(e);if(void 0!==t&&this.recents.get(t)===O.Removed){this.app.send([11,t]);const n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:e=>$r(e)||void 0===this.app.nodes.getID(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1);for(;n.nextNode();)this.app.nodes.unregisterNode(n.currentNode)}}_commitNode(n,e){if(Yr(e))return!0;var t=e.parentNode;let r;if(!A(e,"HTML")||!this.isTopContext){if(null===t)return this.unbindTree(e),!1;if(void 0===(r=this.app.nodes.getID(t)))return this.unbindTree(e),!1;if(!this.commitNode(r))return this.unbindTree(e),!1;if(this.app.sanitizer.handleNode(n,r,e),this.app.sanitizer.isHidden(r))return!1}let i=e.previousSibling;for(;null!==i;){var s=this.app.nodes.getID(i);if(void 0!==s){this.commitNode(s),this.indexes[n]=this.indexes[s]+1;break}i=i.previousSibling}null===i&&(this.indexes[n]=0);var o,a=this.recents.get(n),c=a===O.New,l=this.indexes[n];if(void 0===l)throw"commitNode: missing node index";if(c){if(L(e)){let t=e;void 0!==r&&(this.app.sanitizer.isHidden(n)&&(c=t.clientWidth,o=t.clientHeight,(t=e.cloneNode()).style.width=c+"px",t.style.height=o+"px"),this.app.send([8,n,r,l,t.tagName,Gr(e)]));for(let e=0;e<t.attributes.length;e++){const d=t.attributes[e];this.sendNodeAttribute(n,t,d.nodeName,d.value)}}else Jr(e)&&(this.app.send([9,n,r,l]),this.sendNodeData(n,t,e.data));return!0}a===O.Removed&&void 0!==r&&this.app.send([10,n,r,l]);const d=this.attributesMap.get(n);if(void 0!==d){if(!L(e))throw"commitNode: node is not an element";for(const p of d)this.sendNodeAttribute(n,e,p,e.getAttribute(p))}if(this.textSet.has(n)){if(!Jr(e))throw"commitNode: node is not a text";this.sendNodeData(n,t,e.data)}return!0}commitNode(e){var t=this.app.nodes.getNode(e);if(void 0===t)return!1;var n=this.commited[e];return void 0!==n?n:this.commited[e]=this._commitNode(e,t)}commitNodes(n=!1){let r;this.recents.forEach((e,t)=>{this.commitNode(t),e===O.New&&(r=this.app.nodes.getNode(t))&&this.app.nodes.callNodeCallbacks(r,n)}),this.clear()}observeRoot(e,t,n=e){this.observer.observe(e,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1}),this.bindTree(n),t(this.app.nodes.getID(e)),this.commitNodes(!0)}disconnect(){this.observer.disconnect(),this.clear()}}class Zr extends Qr{observe(e){var t=e.contentDocument;const n=this.app.nodes.getID(e);t&&void 0!==n&&this.observeRoot(t,e=>{void 0===e?console.log("OpenReplay: Iframe document not bound"):this.app.send(Er(n,e))})}}class ei extends Qr{observe(e){var t=e.shadowRoot;const n=this.app.nodes.getID(e);t&&void 0!==n&&this.observeRoot(t,e=>{void 0===e?console.log("OpenReplay: Shadow Root was not bound"):this.app.send(Er(n,e))})}}class ti{constructor(){this.states=new Map}calcOffset(e){let t=0,n=0;if(e.parent&&([t,n]=this.calcOffset(e.parent)),!e.offset){const{left:r,top:i}=e.iFrame.getBoundingClientRect();e.offset=[r,i]}const[r,i]=e.offset;return[t+r,n+i]}getDocumentOffset(e){e=this.states.get(e);return e?this.calcOffset(e):[0,0]}observe(e){var t=e.contentDocument;if(!t)return;const n=e.ownerDocument,r={offset:null,iFrame:e,parent:this.states.get(n)||null,clear:()=>{var e;n.removeEventListener("scroll",i),null!=(e=n.defaultView)&&e.removeEventListener("resize",i)}},i=()=>{r.offset=null};n.addEventListener("scroll",i),null!=(e=n.defaultView)&&e.addEventListener("resize",i),this.states.set(t,r)}clear(){this.states.forEach(e=>e.clear()),this.states.clear()}}const ni=N?Element.prototype.attachShadow:()=>new ShadowRoot;class ri extends Qr{constructor(e,t){super(e,!0),this.iframeOffsets=new ti,this.contextCallbacks=[],this.contextsSet=new Set,this.iframeObservers=[],this.shadowRootObservers=[],this.options=Object.assign({captureIFrames:!0},t),this.app.nodes.attachNodeCallback(e=>{A(e,"IFRAME")&&(this.options.captureIFrames&&!Hr(e,"obscured")||Hr(e,"capture"))&&this.handleIframe(e)}),this.app.nodes.attachNodeCallback(e=>{L(e)&&null!==e.shadowRoot&&this.handleShadowRoot(e.shadowRoot)})}attachContextCallback(e){this.contextCallbacks.push(e)}getDocumentOffset(e){return this.iframeOffsets.getDocumentOffset(e)}handleIframe(r){let i=null;const e=this.app.safe(()=>setTimeout(()=>{var e=this.app.nodes.getID(r);if(void 0!==e){const t=r.contentWindow;e=r.contentDocument;if(e&&e!==i){const n=new Zr(this.app);this.iframeObservers.push(n),n.observe(r),i=e,this.iframeOffsets.observe(r)}t&&t===t.window&&!this.contextsSet.has(t)&&(this.contextsSet.add(t),this.contextCallbacks.forEach(e=>e(t)))}},0));r.addEventListener("load",e),e()}handleShadowRoot(e){const t=new ei(this.app);this.shadowRootObservers.push(t),t.observe(e.host)}observe(){const t=this;Element.prototype.attachShadow=function(){var e=ni.apply(this,arguments);return t.handleShadowRoot(e),e},this.observeRoot(window.document,()=>{this.app.send([7]),this.app.nodes.callNodeCallbacks(document,!0)},window.document.documentElement)}disconnect(){this.iframeOffsets.clear(),Element.prototype.attachShadow=ni,this.iframeObservers.forEach(e=>e.disconnect()),this.iframeObservers=[],this.shadowRootObservers.forEach(e=>e.disconnect()),this.shadowRootObservers=[],super.disconnect()}}(t=dr=dr||{})[t.Plain=0]="Plain",t[t.Obscured=1]="Obscured",t[t.Hidden=2]="Hidden";class ii{constructor(e,t){this.app=e,this.obscured=new Set,this.hidden=new Set,this.options=Object.assign({obscureTextEmails:!0,obscureTextNumbers:!1},t)}handleNode(e,t,n){(this.obscured.has(t)||L(n)&&(Hr(n,"masked")||Hr(n,"obscured")))&&this.obscured.add(e),(this.hidden.has(t)||L(n)&&(Hr(n,"htmlmasked")||Hr(n,"hidden")))&&this.hidden.add(e),void 0!==this.options.domSanitizer&&L(n)&&((t=this.options.domSanitizer(n))===dr.Obscured&&this.obscured.add(e),t===dr.Hidden&&this.hidden.add(e))}sanitize(e,t){return this.obscured.has(e)?t.trim().replace(/[^\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/g,""):(this.options.obscureTextNumbers&&(t=t.replace(/\d/g,"0")),this.options.obscureTextEmails?t.replace(/([^\s]+)@([^\s]+)\.([^\s]+)/g,(...e)=>jr(e[1])+"@"+jr(e[2])+"."+jr(e[3])):t)}isObscured(e){return this.obscured.has(e)}isHidden(e){return this.hidden.has(e)}getInnerTextSecure(e){var t=this.app.nodes.getID(e);return t?this.sanitize(t,e.innerText):""}clear(){this.obscured.clear(),this.hidden.clear()}}class si{constructor(e){this.app=e,this.timer=null,this.callbacks=[]}attach(e,t=0,n=!0,r){r&&(e=e.bind(r)),n&&(e=this.app.safe(e)),this.callbacks.unshift(t?function(e,t){let n=0;return()=>{n++>=t&&(n=0,e())}}(e,t):e)}start(){null===this.timer&&(this.timer=setInterval(()=>this.callbacks.forEach(e=>{e&&e()}),30))}stop(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)}}const oi={Verbose:5,Log:4,Warnings:3,Errors:2,Silent:0};function ai(e){return"object"==typeof e}class ci{constructor(e=oi.Silent){this.options=!0===e?{level:oi.Verbose}:"number"==typeof e?{level:e}:e}log(...e){(ai(this.options.level)?this.options.level.log:this.options.level>=oi.Log)&&console.log(...e)}warn(...e){(ai(this.options.level)?this.options.level.warn:this.options.level>=oi.Warnings)&&console.warn(...e)}error(...e){(ai(this.options.level)?this.options.level.error:this.options.level>=oi.Errors)&&console.error(...e)}}class li{constructor(e,t){this.app=e,this.options=t,this.metadata={},this.userID=null,this.callbacks=[],this.timestamp=0}attachUpdateCallback(e){this.callbacks.push(e)}handleUpdate(t){null==t.userID&&delete t.userID,null==t.sessionID&&delete t.sessionID,this.callbacks.forEach(e=>e(t))}assign(e){void 0!==e.userID&&(this.userID=e.userID),void 0!==e.metadata&&Object.entries(e.metadata).forEach(([e,t])=>this.metadata[e]=t),void 0!==e.sessionID&&(this.sessionID=e.sessionID),void 0!==e.timestamp&&(this.timestamp=e.timestamp),void 0!==e.projectID&&(this.projectID=e.projectID),this.handleUpdate(e)}setMetadata(e,t){this.metadata[e]=t,this.handleUpdate({metadata:{[e]:t}})}setUserID(e){this.userID=e,this.handleUpdate({userID:e})}getPageNumber(){var e=this.app.sessionStorage.getItem(this.options.session_pageno_key);if(null!=e)return parseInt(e)}incPageNo(){let e=this.getPageNumber();return void 0===e?e=0:e++,this.app.sessionStorage.setItem(this.options.session_pageno_key,e.toString()),e}getSessionToken(){return this.app.sessionStorage.getItem(this.options.session_token_key)||void 0}setSessionToken(e){this.app.sessionStorage.setItem(this.options.session_token_key,e)}applySessionHash(e){var t=decodeURI(e).split("&");let n=e,r="100500";2==t.length&&([r,n]=t),r&&n&&(this.app.sessionStorage.setItem(this.options.session_token_key,n),this.app.sessionStorage.setItem(this.options.session_pageno_key,r))}getSessionHash(){var e=this.getPageNumber(),t=this.getSessionToken();if(void 0!==e&&void 0!==t)return encodeURI(String(e)+"&"+t)}getInfo(){return{sessionID:this.sessionID,metadata:this.metadata,userID:this.userID,timestamp:this.timestamp,projectID:this.projectID}}reset(){this.app.sessionStorage.removeItem(this.options.session_token_key),this.metadata={},this.userID=null,this.sessionID=void 0,this.timestamp=0}}const di=N&&"performance"in window&&"memory"in performance?performance:{memory:{}},pi=N?1024*(navigator.deviceMemory||0):0,hi=di.memory.jsHeapSizeLimit||0;const ui="canceled",fi=e=>({reason:e,success:!1}),mi=((T=D=D||{})[T.NotActive=0]="NotActive",T[T.Starting=1]="Starting",T[T.Active=2]="Active","https://api.openreplay.com/ingest");class gi{constructor(e,t,n){this.messages=[],this.startCallbacks=[],this.stopCallbacks=[],this.commitCallbacks=[],this.activityState=D.NotActive,this.version="4.1.9",this.delay=0,this.projectKey=e,this.options=Object.assign({revID:"",node_id:"__openreplay_id",session_token_key:"__openreplay_token",session_pageno_key:"__openreplay_pageno",session_reset_key:"__openreplay_reset",local_uuid_key:"__openreplay_uuid",ingestPoint:mi,resourceBaseHref:null,verbose:!1,__is_snippet:!1,__debug_report_edp:null,localStorage:null,sessionStorage:null},n),this.revID=this.options.revID,this.localStorage=null!=(e=this.options.localStorage)?e:window.localStorage,this.sessionStorage=null!=(e=this.options.sessionStorage)?e:window.sessionStorage,this.sanitizer=new ii(this,n),this.nodes=new qr(this.options.node_id),this.observer=new ri(this,n),this.ticker=new si(this),this.ticker.attach(()=>this.commit()),this.debug=new ci(this.options.__debug__),this.notify=new ci(this.options.verbose?oi.Warnings:oi.Silent),this.session=new li(this,this.options),this.session.attachUpdateCallback(({userID:e,metadata:t})=>{null!=e&&this.send([28,e]),null!=t&&Object.entries(t).forEach(([e,t])=>this.send(wr(e,t)))}),null!=t&&this.session.applySessionHash(t);try{this.worker=new Worker(URL.createObjectURL(new Blob(['"use strict";class t{constructor(t,i,s,e=10,n=1e3){this.onUnauthorised=i,this.onFailure=s,this.MAX_ATTEMPTS_COUNT=e,this.ATTEMPT_TIMEOUT=n,this.attemptsCount=0,this.busy=!1,this.queue=[],this.token=null,this.ingestURL=t+"/v1/web/i"}authorise(t){this.token=t}push(t){this.busy||!this.token?this.queue.push(t):this.sendBatch(t)}retry(t){this.attemptsCount>=this.MAX_ATTEMPTS_COUNT?this.onFailure(`Failed to send batch after ${this.attemptsCount} attempts.`):(this.attemptsCount++,setTimeout(()=>this.sendBatch(t),this.ATTEMPT_TIMEOUT*this.attemptsCount))}sendBatch(t){this.busy=!0,fetch(this.ingestURL,{body:t,method:"POST",headers:{Authorization:"Bearer "+this.token},keepalive:t.length<65536}).then(i=>{if(401===i.status)return this.busy=!1,void this.onUnauthorised();if(i.status>=400)return void this.retry(t);this.attemptsCount=0;const s=this.queue.shift();s?this.sendBatch(s):this.busy=!1}).catch(i=>{console.warn("OpenReplay:",i),this.retry(t)})}clean(){this.queue.length=0}}const i="function"==typeof TextEncoder?new TextEncoder:{encode(t){const i=t.length,s=new Uint8Array(3*i);let e=-1;for(let n=0,r=0,h=0;h!==i;){if(n=t.charCodeAt(h),h+=1,n>=55296&&n<=56319){if(h===i){s[e+=1]=239,s[e+=1]=191,s[e+=1]=189;break}if(r=t.charCodeAt(h),!(r>=56320&&r<=57343)){s[e+=1]=239,s[e+=1]=191,s[e+=1]=189;continue}if(n=1024*(n-55296)+r-56320+65536,h+=1,n>65535){s[e+=1]=240|n>>>18,s[e+=1]=128|n>>>12&63,s[e+=1]=128|n>>>6&63,s[e+=1]=128|63&n;continue}}n<=127?s[e+=1]=0|n:n<=2047?(s[e+=1]=192|n>>>6,s[e+=1]=128|63&n):(s[e+=1]=224|n>>>12,s[e+=1]=128|n>>>6&63,s[e+=1]=128|63&n)}return s.subarray(0,e+1)}};class s extends class{constructor(t){this.size=t,this.offset=0,this.checkpointOffset=0,this.data=new Uint8Array(t)}getCurrentOffset(){return this.offset}checkpoint(){this.checkpointOffset=this.offset}isEmpty(){return 0===this.offset}skip(t){return this.offset+=t,this.offset<=this.size}set(t,i){this.data.set(t,i)}boolean(t){return this.data[this.offset++]=+t,this.offset<=this.size}uint(t){for((t<0||t>Number.MAX_SAFE_INTEGER)&&(t=0);t>=128;)this.data[this.offset++]=t%256|128,t=Math.floor(t/128);return this.data[this.offset++]=t,this.offset<=this.size}int(t){return t=Math.round(t),this.uint(t>=0?2*t:-2*t-1)}string(t){const s=i.encode(t),e=s.byteLength;return!(!this.uint(e)||this.offset+e>this.size)&&(this.data.set(s,this.offset),this.offset+=e,!0)}reset(){this.offset=0,this.checkpointOffset=0}flush(){const t=this.data.slice(0,this.checkpointOffset);return this.reset(),t}}{encode(t){switch(t[0]){case 81:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.int(t[4])&&this.string(t[5]);case 82:return this.uint(t[1])&&this.uint(t[2]);case 0:return this.uint(t[1]);case 4:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3]);case 5:return this.uint(t[1])&&this.uint(t[2]);case 6:return this.int(t[1])&&this.int(t[2]);case 7:return!0;case 8:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.string(t[4])&&this.boolean(t[5]);case 9:case 10:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3]);case 11:return this.uint(t[1]);case 12:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3]);case 13:case 14:return this.uint(t[1])&&this.string(t[2]);case 16:return this.uint(t[1])&&this.int(t[2])&&this.int(t[3]);case 17:return this.uint(t[1])&&this.string(t[2]);case 18:return this.uint(t[1])&&this.string(t[2])&&this.int(t[3]);case 19:return this.uint(t[1])&&this.boolean(t[2]);case 20:return this.uint(t[1])&&this.uint(t[2]);case 22:return this.string(t[1])&&this.string(t[2]);case 23:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8])&&this.uint(t[9]);case 24:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3]);case 25:return this.string(t[1])&&this.string(t[2])&&this.string(t[3]);case 27:return this.string(t[1])&&this.string(t[2]);case 28:case 29:return this.string(t[1]);case 30:return this.string(t[1])&&this.string(t[2]);case 37:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3]);case 38:return this.uint(t[1])&&this.uint(t[2]);case 39:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.uint(t[7]);case 40:return this.string(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 41:return this.string(t[1])&&this.string(t[2]);case 42:return this.string(t[1]);case 44:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3]);case 45:case 46:return this.string(t[1])&&this.string(t[2]);case 47:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3]);case 48:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 49:return this.int(t[1])&&this.int(t[2])&&this.uint(t[3])&&this.uint(t[4]);case 53:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.string(t[7])&&this.string(t[8]);case 54:return this.uint(t[1])&&this.string(t[2]);case 55:return this.boolean(t[1]);case 57:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 58:return this.int(t[1]);case 59:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.string(t[5])&&this.string(t[6])&&this.string(t[7]);case 60:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 61:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3]);case 63:case 64:return this.string(t[1])&&this.string(t[2]);case 67:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 69:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 70:return this.uint(t[1])&&this.uint(t[2]);case 71:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3]);case 73:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 75:case 76:case 77:return this.uint(t[1])&&this.uint(t[2]);case 79:return this.string(t[1])&&this.string(t[2]);case 78:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])}}}class e{constructor(t,i,e,n){this.pageNo=t,this.timestamp=i,this.url=e,this.onBatch=n,this.nextIndex=0,this.beaconSize=2e5,this.encoder=new s(this.beaconSize),this.sizeBuffer=new Uint8Array(3),this.isEmpty=!0,this.beaconSizeLimit=1e6,this.prepare()}writeType(t){return this.encoder.uint(t[0])}writeFields(t){return this.encoder.encode(t)}writeSizeAt(t,i){for(let i=0;i<3;i++)this.sizeBuffer[i]=t>>8*i;this.encoder.set(this.sizeBuffer,i)}prepare(){if(!this.encoder.isEmpty())return;const t=[81,1,this.pageNo,this.nextIndex,this.timestamp,this.url];this.writeType(t),this.writeFields(t),this.isEmpty=!0}writeWithSize(t){const i=this.encoder;if(!this.writeType(t)||!i.skip(3))return!1;const s=i.getCurrentOffset(),e=this.writeFields(t);if(e){const e=i.getCurrentOffset()-s;if(e>16777215)return console.warn("OpenReplay: max message size overflow."),!1;this.writeSizeAt(e,s-3),i.checkpoint(),this.isEmpty=this.isEmpty&&0===t[0],this.nextIndex++}return e}setBeaconSizeLimit(t){this.beaconSizeLimit=t}writeMessage(t){if(0===t[0]&&(this.timestamp=t[1]),4===t[0]&&(this.url=t[1]),!this.writeWithSize(t))for(this.finaliseBatch();!this.writeWithSize(t);){if(this.beaconSize===this.beaconSizeLimit)return console.warn("OpenReplay: beacon size overflow. Skipping large message.",t,this),this.encoder.reset(),void this.prepare();this.beaconSize=Math.min(2*this.beaconSize,this.beaconSizeLimit),this.encoder=new s(this.beaconSize),this.prepare()}}finaliseBatch(){this.isEmpty||(this.onBatch(this.encoder.flush()),this.prepare())}clean(){this.encoder.reset()}}var n;!function(t){t[t.NotActive=0]="NotActive",t[t.Starting=1]="Starting",t[t.Stopping=2]="Stopping",t[t.Active=3]="Active"}(n||(n={}));let r=null,h=null;function u(){h&&h.finaliseBatch()}function a(){n.Stopping,null!==g&&(clearInterval(g),g=null),h&&(h.clean(),h=null),r&&(r.clean(),r=null),n.NotActive}function o(){postMessage("restart"),a()}n.NotActive;let c,g=null;self.onmessage=({data:i})=>{if(null!=i){if("stop"===i)return u(),void a();if(Array.isArray(i)){if(!h)throw new Error("WebWorker: writer not initialised. Service Should be Started.");const t=h;i.forEach(i=>{55===i[0]&&(i[1]?c=setTimeout(()=>o(),18e5):clearTimeout(c)),t.writeMessage(i)})}else{if("start"===i.type)return n.Starting,r=new t(i.ingestPoint,()=>{o()},t=>{!function(t){postMessage({type:"failure",reason:t}),a()}(t)},i.connAttemptCount,i.connAttemptGap),h=new e(i.pageNo,i.timestamp,i.url,t=>r&&r.push(t)),null===g&&(g=setInterval(u,1e4)),n.Active;if("auth"===i.type){if(!r)throw new Error("WebWorker: sender not initialised. Received auth.");if(!h)throw new Error("WebWorker: writer not initialised. Received auth.");return r.authorise(i.token),void(i.beaconSizeLimit&&h.setBeaconSizeLimit(i.beaconSizeLimit))}}}else u()};'],{type:"text/javascript"}))),this.worker.onerror=e=>{this._debug("webworker_error",e)},this.worker.onmessage=({data:e})=>{"restart"===e?(this.stop(!1),this.start({},!0)):"failure"===e.type&&(this.stop(!1),this._debug("worker_failed",e.reason))};var r=()=>{this.worker&&this.worker.postMessage(null)};this.attachEventListener(window,"beforeunload",r,!1),this.attachEventListener(document.body,"mouseleave",r,!1,!1),this.attachEventListener(document,"visibilitychange",r,!1)}catch(e){this._debug("worker_start",e)}}_debug(e,t){null!==this.options.__debug_report_edp&&fetch(this.options.__debug_report_edp,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:e,error:""+t})}),this.debug.error("OpenReplay error: ",e,t)}send(e,t=!1){this.activityState!==D.NotActive&&(this.messages.push(e),this.activityState===D.Active&&t&&this.commit())}commit(){this.worker&&this.messages.length&&(this.messages.unshift([0,this.timestamp()]),this.worker.postMessage(this.messages),this.commitCallbacks.forEach(e=>e(this.messages)),this.messages.length=0)}timestamp(){return Ar()+this.delay}safe(t){const n=this;return function(...e){try{t.apply(this,e)}catch(e){n._debug("safe_fn_call",e)}}}attachCommitCallback(e){this.commitCallbacks.push(e)}attachStartCallback(e,t=!1){t&&(e=this.safe(e)),this.startCallbacks.push(e)}attachStopCallback(e,t=!1){t&&(e=this.safe(e)),this.stopCallbacks.push(e)}attachEventListener(e,t,n,r=!0,i=!0){r&&(n=this.safe(n)),this.attachStartCallback(()=>null==e?void 0:e.addEventListener(t,n,i),r),this.attachStopCallback(()=>null==e?void 0:e.removeEventListener(t,n,i),r)}checkRequiredVersion(e){var t=e.split(/[.-]/),n=this.version.split(/[.-]/);for(let e=0;e<3;e++){if(isNaN(Number(n[e]))||isNaN(Number(t[e])))return!1;if(Number(n[e])>Number(t[e]))return!0;if(Number(n[e])<Number(t[e]))return!1}return!0}getTrackerInfo(){return{userUUID:this.localStorage.getItem(this.options.local_uuid_key),projectKey:this.projectKey,revID:this.revID,trackerVersion:this.version,isSnippet:this.options.__is_snippet}}getSessionInfo(){return Object.assign(Object.assign({},this.session.getInfo()),this.getTrackerInfo())}getSessionToken(){return this.session.getSessionToken()}getSessionID(){return this.session.getInfo().sessionID||void 0}getSessionURL(){var{projectID:e,sessionID:t}=this.session.getInfo();if(e&&t){const n=this.options.ingestPoint;const r=n===mi?n.replace("api","app"):n;return r.replace(/ingest$/,e+"/session/"+t)}this.debug.error("OpenReplay error: Unable to build session URL")}getHost(){return new URL(this.options.ingestPoint).host}getProjectKey(){return this.projectKey}getBaseHref(){var e;return"string"==typeof this.options.resourceBaseHref?this.options.resourceBaseHref:(this.options.resourceBaseHref,document.baseURI||(null==(e=null==(e=document.head)?void 0:e.getElementsByTagName("base")[0])?void 0:e.getAttribute("href"))||location.origin+location.pathname)}resolveResourceURL(e){const t=new URL(this.getBaseHref());return t.pathname+="/"+new URL(e).pathname,t.pathname.replace(/\/+/g,"/"),t.toString()}isServiceURL(e){return e.startsWith(this.options.ingestPoint)}active(){return this.activityState===D.Active}resetNextPageSession(e){e?this.sessionStorage.setItem(this.options.session_reset_key,"t"):this.sessionStorage.removeItem(this.options.session_reset_key)}_start(e={},t=!1){if(!this.worker)return Promise.resolve(fi("No worker found: perhaps, CSP is not set."));if(this.activityState!==D.NotActive)return Promise.resolve(fi("OpenReplay: trying to call `start()` on the instance that has been started already."));this.activityState=D.Starting,Lr=Date.now()-performance.now(),e.sessionHash&&this.session.applySessionHash(e.sessionHash),e.forceNew&&this.session.reset(),this.session.assign({userID:e.userID,metadata:e.metadata});const l=Ar();this.worker.postMessage({type:"start",pageNo:this.session.incPageNo(),ingestPoint:this.options.ingestPoint,timestamp:l,url:document.URL,connAttemptCount:this.options.connAttemptCount,connAttemptGap:this.options.connAttemptGap});var n=null!==this.sessionStorage.getItem(this.options.session_reset_key),e=(this.sessionStorage.removeItem(this.options.session_reset_key),e.forceNew||n||t);return window.fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign(Object.assign({},this.getTrackerInfo()),{timestamp:l,userID:this.session.getInfo().userID,token:e?void 0:this.session.getSessionToken(),deviceMemory:pi,jsHeapSizeLimit:hi}))}).then(t=>200===t.status?t.json():t.text().then(e=>e===ui?Promise.reject(ui):Promise.reject(`Server error: ${t.status}. `+e))).then(e=>{if(!this.worker)return Promise.reject("no worker found after start request (this might not happen)");if(this.activityState===D.NotActive)return Promise.reject("Tracker stopped during authorisation");var{token:t,userUUID:n,projectID:r,beaconSizeLimit:i,delay:s,sessionID:o,startTimestamp:a}=e;if("string"!=typeof t||"string"!=typeof n||"number"!=typeof a&&void 0!==a||"string"!=typeof o||"number"!=typeof s||"number"!=typeof i&&void 0!==i)return Promise.reject("Incorrect server response: "+JSON.stringify(e));this.delay=s,this.session.setSessionToken(t),this.session.assign({sessionID:o,timestamp:a||l,projectID:r}),Object.entries(this.session.getInfo().metadata).forEach(([e,t])=>this.send(wr(e,t))),this.localStorage.setItem(this.options.local_uuid_key,n),this.worker.postMessage({type:"auth",token:t,beaconSizeLimit:i});const c={sessionToken:t,userUUID:n,sessionID:o};return this.startCallbacks.forEach(e=>e(c)),this.observer.observe(),this.ticker.start(),this.activityState=D.Active,this.notify.log("OpenReplay tracking started."),"function"==typeof this.options.onStart&&this.options.onStart(c),e=c,Object.assign(Object.assign({},e),{success:!0})}).catch(e=>(this.stop(),this.session.reset(),e===ui?fi(ui):(this.notify.log("OpenReplay was unable to start. ",e),this._debug("session_start",e),fi(":("))))}start(...n){return document.hidden?new Promise(e=>{const t=()=>{document.hidden||(document.removeEventListener("visibilitychange",t),e(this._start(...n)))};document.addEventListener("visibilitychange",t)}):this._start(...n)}stop(e=!0){if(this.activityState!==D.NotActive)try{this.sanitizer.clear(),this.observer.disconnect(),this.nodes.clear(),this.ticker.stop(),this.stopCallbacks.forEach(e=>e()),this.notify.log("OpenReplay tracking stopped."),this.worker&&e&&this.worker.postMessage("stop")}finally{this.activityState=D.NotActive}}}const vi=N&&"InstallTrigger"in window?e=>e.message+"\n"+e.stack:e=>e.stack||e.message;function yi(e){return void 0===e?"undefined":null===e?"null":e instanceof Error?vi(e):Array.isArray(e)?`Array(${e.length})`:String(e)}function bi(t){if(void 0===t)return"undefined";if(null===t)return"null";if(t instanceof Error)return vi(t);if(Array.isArray(t))return`Array(${t.length})[${t.slice(0,10).map(yi).join(", ")}]`;if("object"!=typeof t)return t.toString();{const r=[];let e=0;for(const i in t){if(10==++e)break;var n=t[i];r.push(i+": "+yi(n))}return"{"+r.join(", ")+"}"}}function Ci(i){return"string"==typeof i[0]&&i.unshift(i.shift().replace(/%(o|s|f|d|i)/g,(e,t)=>{var n,r=i.shift();if(void 0===r)return e;switch(t){case"o":return bi(r);case"s":return yi(r);case"f":return"number"!=typeof(n=r)?"NaN":n.toString();case"d":case"i":return"number"!=typeof(n=r)?"NaN":Math.floor(n).toString();default:return e}})),i.map(bi).join(" ")}const wi=["log","info","warn","error","debug","assert"];function Si(i,e){const s=Object.assign({consoleMethods:wi,consoleThrottling:30},e);if(Array.isArray(s.consoleMethods)&&0!==s.consoleMethods.length){const o=i.safe((e,t)=>i.send([22,e,Ci(t)]));let r;e=()=>{r=0};i.attachStartCallback(e),i.ticker.attach(e,33,!1);const t=i.safe(e=>(e=>s.consoleMethods.forEach(t=>{if(-1===wi.indexOf(t))i.debug.error(`OpenReplay: unsupported console method "${t}"`);else{const n=e[t];e[t]=function(...e){n.apply(this,e),r++>s.consoleThrottling||o(t,e)}}}))(e.console));t(window),i.observer.attachContextCallback(t)}}var _i,ki=Ve(function(e,t){e.exports=function(){function n(e){return!isNaN(parseFloat(e))&&isFinite(e)}function r(e){return e.charAt(0).toUpperCase()+e.substring(1)}function e(e){return function(){return this[e]}}var t=["isConstructor","isEval","isNative","isToplevel"],i=["columnNumber","lineNumber"],s=["fileName","functionName","source"],o,a,c=t.concat(i,s,["args"],["evalOrigin"]);function p(e){if(!e)return;for(var t=0;t<c.length;t++)if(e[c[t]]!==undefined)this["set"+r(c[t])](e[c[t]])}p.prototype={getArgs:function(){return this.args},setArgs:function(e){if(Object.prototype.toString.call(e)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof p)this.evalOrigin=e;else if(e instanceof Object)this.evalOrigin=new p(e);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var e=this.getFileName()||"";var t=this.getLineNumber()||"";var n=this.getColumnNumber()||"";var r=this.getFunctionName()||"";if(this.getIsEval()){if(e)return"[eval] ("+e+":"+t+":"+n+")";return"[eval]:"+t+":"+n}if(r)return r+" ("+e+":"+t+":"+n+")";return e+":"+t+":"+n}},p.fromString=function e(t){var n=t.indexOf("(");var r=t.lastIndexOf(")");var i=t.substring(0,n);var s=t.substring(n+1,r).split(",");var o=t.substring(r+1);if(o.indexOf("@")===0){var a=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(o,"");var c=a[1];var l=a[2];var d=a[3]}return new p({functionName:i,args:s||undefined,fileName:c,lineNumber:l||undefined,columnNumber:d||undefined})};for(var l=0;l<t.length;l++){p.prototype["get"+r(t[l])]=e(t[l]);p.prototype["set"+r(t[l])]=function(t){return function(e){this[t]=Boolean(e)}}(t[l])}for(var d=0;d<i.length;d++){p.prototype["get"+r(i[d])]=e(i[d]);p.prototype["set"+r(i[d])]=function(t){return function(e){if(!n(e))throw new TypeError(t+" must be a Number");this[t]=Number(e)}}(i[d])}for(var h=0;h<s.length;h++){p.prototype["get"+r(s[h])]=e(s[h]);p.prototype["set"+r(s[h])]=function(t){return function(e){this[t]=String(e)}}(s[h])}return p}()}),Ti=Ve(function(e,t){e.exports=function(c){var r=/(^|@)\S+:\d+/;var i=/^\s*at .*(\S+:\d+|\(native\))/m;var s=/^(eval@)?(\[native code])?$/;return{parse:function e(t){if(typeof t.stacktrace!=="undefined"||typeof t["opera#sourceloc"]!=="undefined")return this.parseOpera(t);else if(t.stack&&t.stack.match(i))return this.parseV8OrIE(t);else if(t.stack)return this.parseFFOrSafari(t);else throw new Error("Cannot parse given Error object")},extractLocation:function e(t){if(t.indexOf(":")===-1)return[t];var n=/(.+?)(?::(\d+))?(?::(\d+))?$/;var r=n.exec(t.replace(/[()]/g,""));return[r[1],r[2]||undefined,r[3]||undefined]},parseV8OrIE:function e(t){var n=t.stack.split("\n").filter(function(e){return!!e.match(i)},this);return n.map(function(e){if(e.indexOf("(eval ")>-1)e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,"");var t=e.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,"");var n=t.match(/ (\(.+\)$)/);t=n?t.replace(n[0],""):t;var r=this.extractLocation(n?n[1]:t);var i=n&&t||undefined;var s=["eval","<anonymous>"].indexOf(r[0])>-1?undefined:r[0];return new c({functionName:i,fileName:s,lineNumber:r[1],columnNumber:r[2],source:e})},this)},parseFFOrSafari:function e(t){var n=t.stack.split("\n").filter(function(e){return!e.match(s)},this);return n.map(function(e){if(e.indexOf(" > eval")>-1)e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1");if(e.indexOf("@")===-1&&e.indexOf(":")===-1)return new c({functionName:e});else{var t=/((.*".+"[^@]*)?[^@]*)(?:@)/;var n=e.match(t);var r=n&&n[1]?n[1]:undefined;var i=this.extractLocation(e.replace(t,""));return new c({functionName:r,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:e})}},this)},parseOpera:function e(t){if(!t.stacktrace||t.message.indexOf("\n")>-1&&t.message.split("\n").length>t.stacktrace.split("\n").length)return this.parseOpera9(t);else if(!t.stack)return this.parseOpera10(t);else return this.parseOpera11(t)},parseOpera9:function e(t){var n=/Line (\d+).*script (?:in )?(\S+)/i;var r=t.message.split("\n");var i=[];for(var s=2,o=r.length;s<o;s+=2){var a=n.exec(r[s]);if(a)i.push(new c({fileName:a[2],lineNumber:a[1],source:r[s]}))}return i},parseOpera10:function e(t){var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;var r=t.stacktrace.split("\n");var i=[];for(var s=0,o=r.length;s<o;s+=2){var a=n.exec(r[s]);if(a)i.push(new c({functionName:a[3]||undefined,fileName:a[2],lineNumber:a[1],source:r[s]}))}return i},parseOpera11:function e(t){var n=t.stack.split("\n").filter(function(e){return!!e.match(r)&&!e.match(/^Error created at/)},this);return n.map(function(e){var t=e.split("@");var n=this.extractLocation(t.pop());var r=t.shift()||"";var i=r.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||undefined;var s;if(r.match(/\(([^)]*)\)/))s=r.replace(/^[^(]+\(([^)]*)\)$/,"$1");var o=s===undefined||s==="[arguments not available]"?undefined:s.split(",");return new c({functionName:i,args:o,fileName:n[0],lineNumber:n[1],columnNumber:n[2],source:e})},this)}}}(ki)});function Ei(e){return[{columnNumber:e.colno,lineNumber:e.lineno,fileName:e.filename,functionName:"",source:""}]}function Ri(e,t,n={}){let r=t;try{r=Ti.parse(e)}catch(e){}return Ir(e.name,e.message,JSON.stringify(r),JSON.stringify(n))}function Pi(n,e=window,r={}){if(n instanceof ErrorEvent){if(n.error instanceof Error)return Ri(n.error,Ei(n),r);{let[e,t]=n.message.split(":");return t||(e="Error",t=n.message),Ir(e,t,JSON.stringify(Ei(n)),JSON.stringify(r))}}if("PromiseRejectionEvent"in e&&n instanceof e.PromiseRejectionEvent){if(n.reason instanceof Error)return Ri(n.reason,[],r);{let t;try{t=JSON.stringify(n.reason)}catch(e){t=String(n.reason)}return Ir("Unhandled Promise Rejection",t,"[]",JSON.stringify(r))}}return null}function xi(e,t=document.location){return(e=e.trim()).startsWith("/")?t.origin+e:e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:")?e:t.origin+t.pathname+e}function Oi(i){function r(e,t){i.send(yr(e,"src","https://static.openreplay.com/tracker/placeholder.jpeg"));var{width:n,height:r}=t.getBoundingClientRect();t.hasAttribute("width")||i.send(yr(e,"width",String(n))),t.hasAttribute("height")||i.send(yr(e,"height",String(r)))}function s(e,t){const n=t["srcset"];n&&(t=n.split(",").map(e=>xi(e)).join(","),i.send(yr(e,"srcset",t)))}function o(e,t){1e5<t.src.length&&r(e,t),i.send(Tr(e,"src",t.src,i.getBaseHref()))}const a=i.safe(function(e){e=xi(e.src||"");Br(e)&&i.send(Sr(i.timestamp(),0,0,0,0,0,e,"img"))}),t=i.safe(function(e){var t,n=i.nodes.getID(e);void 0!==n&&e.complete&&(0!==e.naturalHeight||0!==e.naturalWidth||(t=e.src,Nr&&(t.startsWith("data:image/svg+xml")||t.match(/.svg$|/i)))?i.sanitizer.isHidden(n)||i.sanitizer.isObscured(n)?r(n,e):(o(n,e),s(n,e)):a(e))}),n=new MutationObserver(e=>{for(const r of e)if("attributes"===r.type){var t=r.target,n=i.nodes.getID(t);if(void 0===n)return;"src"===r.attributeName&&o(n,t),"srcset"===r.attributeName&&s(n,t)}});i.attachStopCallback(()=>{n.disconnect()}),i.nodes.attachNodeCallback(e=>{A(e,"IMG")&&(i.nodes.attachNodeListener(e,"error",()=>a(e)),i.nodes.attachNodeListener(e,"load",()=>t(e)),t(e),n.observe(e,{attributes:!0,attributeFilter:["src","srcset"]}))})}const Ii=["text","password","email","search","number","range","date"];function Di(e){return A(e,"TEXTAREA")||A(e,"INPUT")&&Ii.includes(e.type)}function Ni(e){if(A(e,"INPUT"))return e=e.type,"checkbox"===e||"radio"===e}const Li=N&&"labels"in HTMLInputElement.prototype?e=>{let t=e;for(;null!==(t=t.parentNode);)if(A(t,"LABEL"))return t;e=e.labels;if(null!==e&&1===e.length)return e[0]}:e=>{let t=e;for(;null!==(t=t.parentNode);)if(A(t,"LABEL"))return t;var n=e.id;if(n){e=e.ownerDocument.querySelectorAll('label[for="'+n+'"]');if(null!==e&&1===e.length)return e[0]}};function Ai(e){let t=Vr(e);var n;return null===t&&(n=Li(e),t=n&&n.innerText||e.placeholder||e.name||e.id||e.className||e.type),Mr(t).slice(0,100)}function ji(s,e){const o=Object.assign({obscureInputNumbers:!0,obscureInputEmails:!0,defaultInputMode:0,obscureInputDates:!1},e);function i(e,t){let n=t.value,r=o.defaultInputMode,i=("password"===t.type||s.sanitizer.isHidden(e)?r=2:(s.sanitizer.isObscured(e)||0===r&&(o.obscureInputNumbers&&"date"!==t.type&&/\d\d\d\d/.test(n)||o.obscureInputDates&&"date"===t.type||o.obscureInputEmails&&("email"===t.type||~n.indexOf("@"))))&&(r=1),0);switch(r){case 2:i=-1,n="";break;case 1:i=n.length,n=""}s.send([18,e,n,i])}const a=new Map,r=new Map,c=new Set;s.attachStopCallback(()=>{a.clear(),r.clear(),c.clear()}),s.ticker.attach(()=>{a.forEach((e,t)=>{var n,r=s.nodes.getNode(t);r&&(Di(r)?e!==r.value&&(a.set(t,r.value),c.has(t)||(c.add(t),e=t,""!==(n=Ai(n=r))&&s.send([17,e,n])),i(t,r)):a.delete(t))}),r.forEach((e,t)=>{var n=s.nodes.getNode(t);n&&(Ni(n)?e!==n.checked&&(r.set(t,n.checked),s.send(Cr(t,n.checked))):r.delete(t))})}),s.ticker.attach(Set.prototype.clear,100,!1,c),s.nodes.attachNodeCallback(s.safe(e=>{const t=s.nodes.getID(e);if(void 0!==t){if(A(e,"SELECT")&&(i(t,e),s.attachEventListener(e,"change",()=>{i(t,e)})),Di(e))return a.set(t,e.value),void i(t,e);Ni(e)&&(r.set(t,e.checked),s.send(Cr(t,e.checked)))}}))}function Mi(e){var t=e.tagName.toUpperCase();return"BUTTON"===t||"A"===t||"LI"===t||"SELECT"===t||null!=e.onclick||"button"===e.getAttribute("role")}function Bi(t,n){if(t instanceof Element){var r=t;var i=n;let e=r;for(;null!==e&&e!==i.documentElement;){if(Hr(e,"masked"))return null;e=e.parentElement}if(Gr(r)){let e=r.ownerSVGElement;for(;null!==e;)e=(r=e).ownerSVGElement}e=r;for(;null!==e&&e!==i.documentElement;){var s=e.tagName.toUpperCase();if("LABEL"===s)return null;if("INPUT"===s)return e;if(Mi(e)||null!==Vr(e))return e;e=e.parentElement}return r===i.documentElement?null:r}return null}function Ui(i){let s=-1,o=-1,a=!1,c=null,l=0,d={};i.attachStopCallback(()=>{s=-1,o=-1,a=!1,c=null,d={}});const p=()=>{a&&(i.send([20,s,o]),a=!1)},t=(r,e=!1)=>{function n(e,t){return d[e]=d[e]||function(e,t){let n=e,r=null;do{if(n.id)return"#"+n.id+(r?" > "+r:"");if(r=n.className.split(" ").map(e=>e.trim()).filter(e=>""!==e).reduce((e,t)=>e+"."+t,n.tagName.toLowerCase())+(r?" > "+r:""),n===t.body)return r}while((n=n.parentElement)!==t.body&&null!==n);return r}(t,r)}const t=e?i.attachEventListener.bind(i):i.nodes.attachNodeListener.bind(i.nodes);t(r.documentElement,"mouseover",e=>{e=Bi(e.target,r);e!==c&&(c=e,l=performance.now())}),t(r,"mousemove",e=>{var[t,n]=i.observer.getDocumentOffset(r);s=e.clientX+t,o=e.clientY+n,a=!0},!1),t(r,"click",e=>{var t=Bi(e.target,r);(e.clientX||e.clientY)&&null!==t&&(void 0!==(e=i.nodes.getID(t))&&(p(),i.send([69,e,c===t?Math.round(performance.now()-l):0,function(t){var e=Vr(t);if(null!==e)return e;if(A(t,"INPUT"))return Ai(t);if(Mi(t)){let e="";return Mr(e=(e=t instanceof HTMLElement?i.sanitizer.getInnerTextSecure(t):e)||t.id||t.className).slice(0,100)}return""}(t),n(e,t)],!0)),c=null)})};i.nodes.attachNodeCallback(e=>{Kr(e)&&t(e)}),t(document,!0),i.ticker.attach(p,10)}function Fi(p,e){const n=Object.assign({captureResourceTimings:!0,capturePageLoadTimings:!0,capturePageRenderTimings:!0},e);if("PerformanceObserver"in window||(n.captureResourceTimings=!1),n.captureResourceTimings){let c={};const i=new PerformanceObserver(e=>e.getEntries().forEach(r));let t,l=(p.attachStartCallback(function({sessionID:e}){e!==t&&(performance.getEntriesByType("resource").forEach(r),t=e),i.observe({entryTypes:["resource"]})}),p.attachStopCallback(function(){i.disconnect()}),0),d=0;if(n.capturePageLoadTimings){let c=!1;p.ticker.attach(()=>{var e,t,n,r,i,s,o,a;c||(0!==l&&0!==d||performance.getEntriesByType("paint").forEach(e=>{var{name:e,startTime:t}=e;switch(e){case"first-paint":l=t;break;case"first-contentful-paint":d=t}}),(performance.timing.loadEventEnd||3e4<performance.now())&&(c=!0,{navigationStart:e,requestStart:t,responseStart:n,responseEnd:r,domContentLoadedEventStart:i,domContentLoadedEventEnd:s,loadEventStart:o,loadEventEnd:a}=performance.timing,p.send([23,t-e||0,n-e||0,r-e||0,i-e||0,s-e||0,o-e||0,a-e||0,l,d])))},30)}if(n.capturePageRenderTimings){let r=0,i=0,s=0,o=null,a=!1;p.ticker.attach(()=>{var e,t,n;a||(e=performance.now(),null!==c&&1e3<e-(r=Math.max.apply(null,Object.keys(c).map(e=>c[e])))&&(o=function(n){const r=[];var i,s,o,a,c,l=document.getElementsByTagName("*");const d=/url\(("[^"]*"|'[^']*'|[^)]*)\)/i;for(let t=0;t<l.length;t++){const p=l[t];let e="";(e=A(p,"IMG")?p.currentSrc||p.src:e)||(i=getComputedStyle(p).getPropertyValue("background-image"))&&null!==(i=d.exec(i))&&((e=i[1]).startsWith('"')||e.startsWith("'"))&&(e=e.substr(1,e.length-2)),e&&(void 0!==(i="data:image"===e.substr(0,10)?0:n[e])&&(c=p.getBoundingClientRect(),s=Math.max(c.top,0),o=Math.max(c.left,0),a=Math.min(c.bottom,window.innerHeight||document.documentElement&&document.documentElement.clientHeight||0),c=Math.min(c.right,window.innerWidth||document.documentElement&&document.documentElement.clientWidth||0),a<=s||c<=o||r.push({time:i,area:(a-s)*(c-o)})))}return r}(c),c=null),null!==s&&(50<e-s&&(i=e),s=5e3<e-i?null:e),(null!==o&&null===s||3e4<e)&&(a=!0,e=(c=null)===o?0:function(t,n){let r=Math.max(document.documentElement&&document.documentElement.clientWidth||0,window.innerWidth||0)*Math.max(document.documentElement&&document.documentElement.clientHeight||0,window.innerHeight||0)/10,i=r*t;for(let e=0;e<n.length;e++){var{time:s,area:o}=n[e];r+=o,i+=o*(t<s?s:t)}return 0===r?0:i/r}(d||l,o),{domContentLoadedEventEnd:n,navigationStart:t}=performance.timing,n=null===s?Math.max(i,d,n-t||0):0,p.send([24,e,d>r?d:r,n])))})}function r(e){e.duration<0||!Br(e.name)||p.isServiceURL(e.name)||(null!==c&&(c[e.name]=e.startTime+e.duration),p.send(Sr(e.startTime+performance.timing.navigationStart,e.duration,e.responseStart&&e.startTime?e.responseStart-e.startTime:0,e.transferSize>e.encodedBodySize?e.transferSize-e.encodedBodySize:0,e.encodedBodySize||0,e.decodedBodySize||0,e.name,e.initiatorType)))}}}function zi(e){var t=e.defaultView;return[t&&t.pageXOffset||e.documentElement&&e.documentElement.scrollLeft||e.body&&e.body.scrollLeft||0,t&&t.pageYOffset||e.documentElement&&e.documentElement.scrollTop||e.body&&e.body.scrollTop||0]}function Vi(n){let t=!1;const r=new Map;function i(e){Wr(e)&&(L(e)&&r.set(e,[e.scrollLeft,e.scrollTop]),Kr(e)&&r.set(e,zi(e)))}const e=n.safe(()=>n.send(function(e,t){return[6,e,t]}(...zi(document)))),s=n.safe((e,t)=>{t=n.nodes.getID(t);void 0!==t&&n.send([16,t,e[0],e[1]])});n.attachStartCallback(e),n.attachStopCallback(()=>{t=!1,r.clear()}),n.nodes.attachNodeCallback((e,t)=>{t&&(L(e)&&0<e.scrollLeft+e.scrollTop?r.set(e,[e.scrollLeft,e.scrollTop]):Kr(e)&&r.set(e,zi(e))),Yr(e)&&n.nodes.attachNodeListener(e,"scroll",e=>{i(e.target)})}),n.attachEventListener(document,"scroll",e=>{e=e.target;e===document?t=!0:i(e)}),n.ticker.attach(()=>{t&&(e(),t=!1),r.forEach(s),r.clear()},5,!1)}function Hi(n){let t,r,i,s;const e=n.safe(()=>{var e=document["URL"];e!==t&&(t=e,n.send([4,t,document.referrer,s]),s=0)}),o=n.safe(()=>{var{innerWidth:e,innerHeight:t}=window;e===r&&t===i||(r=e,i=t,n.send([5,r,i]))}),a=void 0===document.hidden?Function.prototype:n.safe(()=>n.send([55,document.hidden]));n.attachStartCallback(()=>{t="",s=Lr,r=i=-1,e(),o(),a()}),void 0!==document.hidden&&n.attachEventListener(document,"visibilitychange",a,!1,!1),n.ticker.attach(e,1,!1),n.ticker.attach(o,5,!1)}function qi(e){return Yr(e)&&e.adoptedStyleSheets}let Wi=15;const Gi=new Map;const Ji="/installation/setup-or";class Ki{constructor(e){if(this.options=e,this.app=null,this.handleError=(e,t={})=>{var n;null!==this.app&&(e instanceof Error?(n=Ri(e,[],t),this.app.send(n)):(e instanceof ErrorEvent||"PromiseRejectionEvent"in window&&e instanceof PromiseRejectionEvent)&&null!=(n=Pi(e,void 0,t))&&this.app.send(n))},N&&function(e){if(null!=e){if("string"!=typeof e.projectKey)if("number"!=typeof e.projectKey){if("number"!=typeof e.projectID)return console.error(`OpenReplay: projectKey is missing or wrong type (string is expected). Please, check ${Ur}${Ji} for more information.`),0;e.projectKey=e.projectID.toString(),zr("`projectID` option","`projectKey` option",Ji)}else console.warn("OpenReplay: projectKey is expected to have a string type."),e.projectKey=e.projectKey.toString();return null!=e.sessionToken&&zr("`sessionToken` option","`sessionHash` start() option","/"),1}console.error("OpenReplay: invalid options argument type. Please, check documentation on "+Ur+Ji)}(e))if(window.__OPENREPLAY__)console.error("OpenReplay: one tracker instance has been initialised already");else if(e.__DISABLE_SECURE_MODE||"https:"===location.protocol){var n,t=e.respectDoNotTrack&&("1"==navigator.doNotTrack||"1"==window.doNotTrack);const f=this.app=!t&&"Map"in window&&"Set"in window&&"MutationObserver"in window&&"performance"in window&&"timing"in performance&&"startsWith"in String.prototype&&"Blob"in window&&"Worker"in window?new gi(e.projectKey,e.sessionToken,e):null;if(null!==f){Hi(f);var o=f;if(null!==o)if(window.CSSStyleSheet){const m=o.safe((e,t,n)=>{e=Gi.get(e);e&&("string"==typeof n?o.send(Pr(e,n,t,o.getBaseHref())):o.send(xr(e,t)))}),g=o.safe(e=>{let t=e;for(;t.parentRule;)t=t.parentRule;var n,r,i,s=t.parentStyleSheet;s?(n=Gi.get(s))?(r=t.cssText,i=s.cssRules,0<=(i=Array.from(i).indexOf(t))?(o.send(Pr(n,r,i,o.getBaseHref())),o.send(xr(n,i+1))):o.debug.warn("Rule index not found in",s,t)):o.debug.warn("No sheedID found for",s,Gi):o.debug.warn("No parent StyleSheet found for",t,e)}),v=o.safe(e=>{const{insertRule:n,deleteRule:t}=e.CSSStyleSheet.prototype,{insertRule:r,deleteRule:i}=e.CSSGroupingRule.prototype;e.CSSStyleSheet.prototype.insertRule=function(e,t=0){return m(this,t,e),n.call(this,e,t)},e.CSSStyleSheet.prototype.deleteRule=function(e){return m(this,e),t.call(this,e)},e.CSSGroupingRule.prototype.insertRule=function(e,t=0){e=r.call(this,e,t);return g(this),e},e.CSSGroupingRule.prototype.deleteRule=function(e=0){e=i.call(this,e);return g(this),e}});v(window),o.observer.attachContextCallback(v),o.nodes.attachNodeCallback(e=>{if((A(e,"STYLE")||A(e,"style"))&&e.sheet&&!(null!==e.textContent&&0<e.textContent.trim().length)){var t=o.nodes.getID(e);if(t){var n=e.sheet,e=Wi++,r=(Gi.set(n,e),o.send(Or(e,t)),n.cssRules);for(let e=0;e<r.length;e++)m(n,e,r[e].cssText)}}})}else o.send([63,"no_stylesheet_prototype_in_window",""]);var c=f;if(null!==c&&qi(document)){const y=new Map,b=new Map,C=a=>setTimeout(()=>{let n=c.nodes.getID(a);if(void 0!==(n=a===document?0:n)){let e=b.get(n);e=e||[];const s=[];for(const o of a.adoptedStyleSheets){let t=y.get(o);var r=!t;if(t||(t=Wi++,y.set(o,t)),e.includes(t)||c.send(Or(t,n)),r){var i=o.cssRules;for(let e=0;e<i.length;e++)c.send(Pr(t,i[e].cssText,e,c.getBaseHref()))}s.push(t)}for(const t of e)s.includes(t)||c.send([77,t,n]);b.set(n,s)}},20);var r=e=>{if(!e.__openreplay_adpss_patched__){e.__openreplay_adpss_patched__=!0,i(e.Document.prototype),i(e.ShadowRoot.prototype);const{replace:t,replaceSync:n}=e.CSSStyleSheet.prototype;e.CSSStyleSheet.prototype.replace=function(n){return t.call(this,n).then(e=>{var t=y.get(this);return t&&c.send(Rr(t,n,c.getBaseHref())),e})},e.CSSStyleSheet.prototype.replaceSync=function(e){var t=y.get(this);return t&&c.send(Rr(t,e,c.getBaseHref())),n.call(this,e)}}};function i(e){const t=Object.getOwnPropertyDescriptor(e,"adoptedStyleSheets");t&&Object.defineProperty(e,"adoptedStyleSheets",Object.assign(Object.assign({},t),{set:function(e){e=t.set.call(this,e);return C(this),e}}))}r(window),c.observer.attachContextCallback(c.safe(r)),c.attachStopCallback(()=>{y.clear(),b.clear()}),c.attachStartCallback(()=>{C(document)}),c.nodes.attachNodeCallback(e=>{qi(e)&&C(e)})}{var s=f;const w=navigator.connection||navigator.mozConnection||navigator.webkitConnection;void 0!==w&&((r=()=>s.send([54,Math.round(1e3*w.downlink),w.type||"unknown"]))(),w.addEventListener("change",r))}Si(f,e),n=f,Object.assign({captureExceptions:!0},e).captureExceptions&&(n.observer.attachContextCallback(u),u(window)),Oi(f),ji(f,e),Ui(f),Fi(f,e);var a=f,l=e;if(Object.assign({capturePerformance:!0},l).capturePerformance){let e,t;const S=()=>{void 0!==e&&-1!==e&&(e++,requestAnimationFrame(S))},_=(a.ticker.attach(()=>{void 0!==t&&-1!==t&&t++},0,!1),()=>{void 0!==e&&void 0!==t&&(a.send([49,e,t,di.memory.totalJSHeapSize||0,di.memory.usedJSHeapSize||0]),t=e=document.hidden?-1:0)});a.attachStartCallback(()=>{t=e=-1,_(),S()}),a.attachStopCallback(()=>{t=e=void 0}),a.ticker.attach(_,40,!1),void 0!==document.hidden&&a.attachEventListener(document,"visibilitychange",_,!1,!1)}Vi(f);{var d=f;function p(e){e=d.nodes.getID(e);void 0!==e&&d.send(kr(e))}let t=!1;d.nodes.attachNodeCallback(e=>{A(e,"BODY")&&(d.nodes.attachNodeListener(e,"focus",e=>{Wr(e.target)&&(p(e.target),t=!1)}),d.nodes.attachNodeListener(e,"blur",e=>{null===e.relatedTarget&&(t=!0,setTimeout(()=>{t&&d.send(kr(-1))},0))}))}),d.attachStartCallback(()=>{let e=document.activeElement;for(;e&&A(e,"IFRAME")&&e.contentDocument;)e=e.contentDocument.activeElement;e&&e!==e.ownerDocument.body&&p(e)},!0)}var h=f;if(window.FontFace){const k=new Map;l=s=>{class e extends s.FontFace{constructor(...t){if("string"==typeof t[1]){let e="";t[2]&&h.safe(()=>{e=JSON.stringify(t[2])});var n=[t[0],t[1],e];const i=k.get(s.document)||[];i.push(n),k.set(s.document,i);var r=s===window?0:h.nodes.getID(s.document);if(void 0===r)return;h.active()&&h.send(_r(r,...n))}super(...t)}}s.FontFace=e};h.observer.attachContextCallback(l),l(window),h.nodes.attachNodeCallback(e=>{if(Kr(e)){const t=k.get(e);if(t){const n=e.defaultView===window?0:h.nodes.getID(e);void 0!==n&&t.forEach(e=>{h.send(_r(n,...e))})}}})}if(window.__OPENREPLAY__=this,e.autoResetOnWindowOpen){const T=window.open;f.attachStartCallback(()=>{window.open=function(...e){f.resetNextPageSession(!0),T.call(window,...e),f.resetNextPageSession(!1)}}),f.attachStopCallback(()=>{window.open=T})}}else{console.log("OpenReplay: browser doesn't support API required for tracking or doNotTrack is set to 1.");const E=new XMLHttpRequest;l=e.ingestPoint||mi;E.open("POST",l+"/v1/web/not-started"),E.send(JSON.stringify({trackerVersion:"4.1.9",projectKey:e.projectKey,doNotTrack:t}))}function u(t){function e(e){e=Pi(e,t);null!=e&&n.send(e)}n.attachEventListener(t,"unhandledrejection",e),n.attachEventListener(t,"error",e)}}else console.error("OpenReplay: Your website must be publicly accessible and running on SSL in order for OpenReplay to properly capture and replay the user session. You can disable this check by setting `__DISABLE_SECURE_MODE` option to `true` if you are testing in localhost. Keep in mind, that asset files on a local machine are not available to the outside world. This might affect tracking if you use css files.")}use(e){return e(this.app,this.options)}isActive(){return null!==this.app&&this.app.active()}start(e){return N?null===this.app?Promise.reject("Browser doesn't support required api, or doNotTrack is active."):this.app.start(e):(console.error("OpenReplay: you are trying to start Tracker on a node.js environment. If you want to use OpenReplay with SSR, please, use componentDidMount or useEffect API for placing the `tracker.start()` line. Check documentation on "+Ur+Ji),Promise.reject("Trying to start not in browser."))}stop(){if(null!==this.app)return this.app.stop(),this.app.session.getSessionHash()}getSessionToken(){return null===this.app?null:this.app.getSessionToken()}getSessionID(){return null===this.app?null:this.app.getSessionID()}sessionID(){return zr("'sessionID' method","'getSessionID' method","/"),this.getSessionID()}getSessionURL(){if(null!==this.app)return this.app.getSessionURL()}setUserID(e){"string"==typeof e&&null!==this.app&&this.app.session.setUserID(e)}userID(e){zr("'userID' method","'setUserID' method","/"),this.setUserID(e)}setUserAnonymousID(e){"string"==typeof e&&null!==this.app&&this.app.send([29,e])}userAnonymousID(e){zr("'userAnonymousID' method","'setUserAnonymousID' method","/"),this.setUserAnonymousID(e)}setMetadata(e,t){"string"==typeof e&&"string"==typeof t&&null!==this.app&&this.app.session.setMetadata(e,t)}metadata(e,t){zr("'metadata' method","'setMetadata' method","/"),this.setMetadata(e,t)}event(e,t=null,n=!1){if("string"==typeof e&&null!==this.app){if(n)return this.issue(e,t);try{t=JSON.stringify(t)}catch(e){return}this.app.send([27,e,t])}}issue(e,t=null){if("string"==typeof e&&null!==this.app){try{t=JSON.stringify(t)}catch(e){return}this.app.send([64,e,t])}}}(function(e){var e=0<arguments.length&&void 0!==e?e:{},t=window.OpenReplay||window.asayer,n=t.shift(),r=t.shift(),i=t.shift(),n=("object"===vr(i="number"==typeof i?{obscureTextEmails:!!(1&i),obscureTextNumbers:!!(i>>1&1),obscureInputNumbers:!!(i>>3&1),obscureInputEmails:!!(i>>4&1),defaultInputMode:i>>5}:i)&&null!==i||(i={}),Object.assign({projectKey:n,sessionToken:r},i,e,{__is_snippet:!0})),s=(t.i&&(n.ingestPoint=t.i),window.OpenReplay=window.asayer=new Ki(n)),o=s.setUserID.bind(s),a=(s.setUserID=s.userID=function(e){void 0!==vr(e)&&null!==e&&o(e.toString())},s.setUserAnonymousID.bind(s)),c=(s.setUserAnonymousID=s.userAnonymousID=function(e){void 0!==vr(e)&&null!==e&&a(e.toString())},s.setMetadata.bind(s)),l=(s.setMetadata=s.metadata=function(e,t){"number"==typeof t&&NaN!==t&&(t=t.toString()),"string"==typeof e&&"string"==typeof t&&c(e,t)},s.event.bind(s));for(s.event=function(e,t){"string"==typeof e&&l(e,t)};t.length;){var d=t.shift();switch(d[0]){case 0:s.start(d[1]);break;case 1:s.stop();break;case 2:s.setUserID(d[1]);break;case 3:s.setUserAnonymousID(d[1]);break;case 4:s.setMetadata(d[1],d[2]);break;case 5:s.event(d[1],d[2],d[3]);break;case 6:s.issue(d[1],d[2])}}return s})().use(function(e,t={}){var n;if(null!==e&&null!=(n=null===navigator||void 0===navigator?void 0:navigator.mediaDevices)&&n.getUserMedia){if(e.checkRequiredVersion&&e.checkRequiredVersion("3.5.14"))return e.notify.log("OpenReplay Assist initializing."),n=new gr(e,_i,t.__DISABLE_SECURE_MODE),e.debug.log(n),n;console.warn("OpenReplay Assist: couldn't load. The minimum required version of @openreplay/tracker@3.5.14 is not met")}})}();